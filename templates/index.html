<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Game Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            color: #1a202c;
            font-size: 16px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            color: #1a202c;
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            color: #4a5568;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .last-updated {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .btn-small {
            padding: 6px 12px;
            border: 1px solid #cbd5e0;
            background: white;
            color: #4a5568;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .btn-small:hover {
            background: #f7fafc;
            border-color: #667eea;
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 30px;
            background: white;
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: #6b7280;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: #f8fafc;
            color: #4a5568;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .controls {
            background: white;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: space-between;
        }

        .week-selector {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-bottom: 20px;
            border: 3px solid #4299e1;
        }

        .week-selector label {
            font-weight: 700;
            color: white;
            font-size: 1.4rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
        }

        .week-selector .week-prompt {
            color: #f7fafc;
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 500;
        }

        .week-selector select {
            padding: 15px 25px;
            border: 3px solid #4299e1;
            border-radius: 10px;
            font-size: 1.3rem;
            font-weight: 600;
            background: white;
            cursor: pointer;
            min-width: 180px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .week-selector select:focus {
            outline: none;
            border-color: #2b6cb0;
            transform: scale(1.05);
            box-shadow: 0 4px 16px rgba(66, 153, 225, 0.4);
        }

        .week-selector select:hover {
            transform: scale(1.02);
            border-color: #3182ce;
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 18px;
            border: 2px solid #cbd5e0;
            background: white;
            color: #2d3748;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: #f7fafc;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #cbd5e0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #a0aec0;
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
        }

        .btn-danger:hover {
            background: #c53030;
        }

        .picks-summary {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .picks-count {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .game-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 8px;
            border: 2px solid #e2e8f0;
        }

        .game-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border-color: #cbd5e0;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e2e8f0;
            background: #f8fafc;
            margin: -20px -20px 24px -20px;
            padding: 16px 20px;
            border-radius: 12px 12px 0 0;
        }

        .game-time {
            font-size: 1rem;
            color: #2d3748;
            font-weight: 600;
        }

        .game-status {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pregame {
            background: #e6fffa;
            color: #319795;
        }

        .status-live {
            background: #fed7d7;
            color: #e53e3e;
        }

        .status-final {
            background: #e2e8f0;
            color: #4a5568;
        }

        .matchup {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 20px 0;
            background: #ffffff;
            border-radius: 12px;
            border: 1px solid #f1f5f9;
        }

        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .team-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-bottom: 8px;
            border: 3px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }

        .team-logo:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .team-name {
            font-weight: 800;
            font-size: 1.2rem;
            text-align: center;
            margin-top: 8px;
            color: #1a202c;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .team-record {
            font-size: 1rem;
            color: #6b7280;
            margin-top: 4px;
            font-weight: 600;
            background: #f3f4f6;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .team-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin-top: 5px;
        }

        .vs {
            font-size: 1.4rem;
            font-weight: 700;
            color: #a0aec0;
            margin: 0 15px;
        }

        .betting-info {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .betting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #f1f5f9;
            transition: all 0.2s ease;
        }

        .betting-row:last-child {
            margin-bottom: 0;
        }

        .betting-label {
            font-size: 1rem;
            color: #4a5568;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .betting-value {
            font-weight: 800;
            color: #1a202c;
            font-size: 1.1rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .spread-large {
            color: #38a169;
        }

        .spread-close {
            color: #e53e3e;
        }

        .weather-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f1f5f9;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1rem;
            font-weight: 500;
            color: #1a202c;
            border: 1px solid #e2e8f0;
        }

        .weather-temp {
            font-weight: bold;
        }

        .weather-condition {
            color: #4a5568;
        }

        .weather-warning {
            background: #fed7d7;
            color: #c53030;
        }

        .eliminator-rec {
            background: linear-gradient(135deg, #f0fff4 0%, #f7fafc 100%);
            border: 2px solid #c6f6d5;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .rec-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e6fffa;
        }

        .rec-team {
            font-weight: 800;
            font-size: 1.2rem;
            color: #047857;
            background: linear-gradient(135deg, #059669, #047857);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .confidence-badge {
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease;
        }

        .confidence-high {
            background: linear-gradient(135deg, #10b981, #047857);
            color: white;
        }

        .confidence-medium {
            background: linear-gradient(135deg, #f59e0b, #b45309);
            color: white;
        }

        .confidence-low {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
        }

        .confidence-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .safety-score {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            transition: all 0.2s ease;
            cursor: help;
        }

        .safety-score:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .rec-reasons {
            font-size: 0.9rem;
            color: #4a5568;
        }

        .rec-reasons ul {
            margin: 5px 0;
            padding-left: 20px;
        }

        .rec-warnings {
            color: #e53e3e;
            font-size: 0.85rem;
            font-style: italic;
        }

        .venue {
            text-align: center;
            font-size: 1rem;
            color: #4a5568;
            margin-top: 16px;
            font-weight: 600;
            padding: 8px 12px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .injury-indicator {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 16px;
            height: 16px;
            background: #e53e3e;
            border-radius: 50%;
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: bold;
        }

        .injury-warning {
            background: #fed7d7;
            color: #c53030;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            margin: 5px 0;
        }

        .injury-details {
            font-size: 0.8rem;
            color: #4a5568;
            margin-top: 5px;
        }

        .injury-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-right: 5px;
        }

        .injury-out {
            background: #e53e3e;
            color: white;
        }

        .injury-doubtful {
            background: #ed8936;
            color: white;
        }

        .injury-questionable {
            background: #f6e05e;
            color: #744210;
        }

        .injury-probable {
            background: #48bb78;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4a5568;
        }

        .modal-close:hover {
            color: #4a5568;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4a5568;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .picks-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
        }

        .picks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .pick-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pick-info {
            flex: 1;
        }

        .pick-user {
            font-weight: bold;
            color: #2d3748;
        }

        .pick-team {
            color: #667eea;
            font-size: 1.1rem;
            font-weight: bold;
            margin: 2px 0;
        }

        .pick-reasoning {
            font-size: 0.9rem;
            color: #4a5568;
        }

        .pick-actions {
            display: flex;
            gap: 8px;
        }

        .pick-actions button {
            padding: 5px 10px;
            font-size: 0.8rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #4a5568;
        }

        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #4a5568;
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .filters {
                justify-content: center;
            }

            .games-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .game-card {
                padding: 15px;
            }

            .matchup {
                flex-direction: column;
                gap: 10px;
            }

            .team {
                width: 100%;
                flex-direction: row;
                justify-content: space-between;
            }

            .vs {
                margin: 10px 0;
                align-self: center;
            }

            .modal-content {
                margin: 10% 10px;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .filters {
                flex-direction: column;
            }

            .filter-btn {
                text-align: center;
            }

            .betting-info {
                font-size: 0.85rem;
            }

            .pick-card {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .pick-actions {
                justify-content: center;
            }
        }

        /* Enhanced Modal and Analytics Styles */
        .modal-team-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 10px;
            border: 2px solid #e2e8f0;
            vertical-align: middle;
        }

        .analytics-section {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .team-analytics {
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .team-analytics h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .matchup-advantages {
            background: #fff7ed;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid #fed7aa;
        }

        .matchup-advantages ul {
            margin-top: 5px;
            margin-left: 15px;
        }

        .matchup-advantages li {
            color: #ea580c;
            font-weight: 500;
        }

        .injury-section {
            background: #fef2f2;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #ef4444;
        }

        .injury-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .team-injuries {
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .team-injuries h4 {
            color: #dc2626;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .team-injuries ul {
            margin-left: 15px;
        }

        .team-injuries li {
            font-size: 0.9rem;
            color: #7f1d1d;
            margin-bottom: 3px;
        }

        .injury-impact {
            margin-top: 10px;
            text-align: center;
        }

        .impact-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .impact-high {
            background: #fee2e2;
            color: #dc2626;
        }

        .impact-medium {
            background: #fef3c7;
            color: #d97706;
        }

        .impact-low {
            background: #d1fae5;
            color: #059669;
        }

        .news-section {
            background: #f9fafb;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #6b7280;
        }

        .news-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .news-item:last-child {
            margin-bottom: 0;
        }

        .news-headline {
            font-weight: bold;
            color: #374151;
            margin-bottom: 5px;
        }

        .news-description {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .news-source {
            font-size: 0.8rem;
            color: #9ca3af;
            font-style: italic;
        }

        /* Probability Display Styles */
        .win-probability {
            font-size: 0.9rem;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 12px;
            margin-top: 5px;
            text-align: center;
            color: #1a202c;
            border: 2px solid rgba(255,255,255,0.9);
            min-width: 50px;
        }

        .probability-section {
            background: #f7fafc;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 12px;
            border-left: 4px solid #1e40af;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .probability-bar-container {
            margin-bottom: 5px;
        }

        .probability-bar {
            display: flex;
            height: 30px;
            background: #f3f4f6;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .prob-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: white;
            transition: all 0.3s ease;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            position: relative;
            min-width: 60px;
        }

        .prob-segment:hover {
            filter: brightness(1.1);
            z-index: 1;
        }

        .away-segment {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .home-segment {
            background: linear-gradient(135deg, #059669, #047857);
        }

        .probability-method {
            font-size: 0.8rem;
            color: #4b5563;
            text-align: center;
            font-weight: 600;
            background: #f9fafb;
            padding: 4px 8px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            margin-top: 4px;
        }


        /* Enhanced Confidence Badges */
        .confidence-very_high {
            background: linear-gradient(135deg, #047857, #065f46);
            color: white;
            animation: pulse-very-high 2s infinite;
            box-shadow: 0 2px 4px rgba(4, 120, 87, 0.3);
        }

        .confidence-high {
            background: linear-gradient(135deg, #1e40af, #1e3a8a);
            color: white;
            box-shadow: 0 2px 4px rgba(30, 64, 175, 0.3);
        }

        .confidence-medium {
            background: linear-gradient(135deg, #b45309, #92400e);
            color: white;
            box-shadow: 0 2px 4px rgba(180, 83, 9, 0.3);
        }

        .confidence-low {
            background: linear-gradient(135deg, #b91c1c, #991b1b);
            color: white;
            box-shadow: 0 2px 4px rgba(185, 28, 28, 0.3);
        }

        @keyframes pulse-very-high {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            50% { 
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
        }

        /* Probability Heat Map Colors */
        .game-card[data-confidence="very_high"] {
            border-left: 6px solid #047857;
            background: linear-gradient(135deg, rgba(4, 120, 87, 0.08), rgba(4, 120, 87, 0.03));
            box-shadow: 0 2px 8px rgba(4, 120, 87, 0.1);
        }

        .game-card[data-confidence="high"] {
            border-left: 6px solid #1e40af;
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.08), rgba(30, 64, 175, 0.03));
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.1);
        }

        .game-card[data-confidence="medium"] {
            border-left: 6px solid #b45309;
            background: linear-gradient(135deg, rgba(180, 83, 9, 0.08), rgba(180, 83, 9, 0.03));
            box-shadow: 0 2px 8px rgba(180, 83, 9, 0.1);
        }

        .game-card[data-confidence="low"] {
            border-left: 6px solid #b91c1c;
            background: linear-gradient(135deg, rgba(185, 28, 28, 0.08), rgba(185, 28, 28, 0.03));
            box-shadow: 0 2px 8px rgba(185, 28, 28, 0.1);
        }

        /* History Tab Styles */
        .history-section {
            max-width: 1200px;
            margin: 0 auto;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .week-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .history-timeline {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .performance-summary {
            margin-top: 30px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .summary-card h3 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        /* Strategy Tab Styles */
        .strategy-section {
            max-width: 1200px;
            margin: 0 auto;
        }

        .strategy-header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .strategy-header h2 {
            color: #1a202c;
            margin-bottom: 10px;
        }

        .strategy-header p {
            color: #6b7280;
            font-size: 1.1rem;
        }

        .strategy-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .strategy-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .strategy-card h3 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        /* Settings Tab Styles */
        .settings-section {
            max-width: 800px;
            margin: 0 auto;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .settings-header h2 {
            color: #1a202c;
            margin-bottom: 10px;
        }

        .settings-header p {
            color: #6b7280;
            font-size: 1.1rem;
        }

        .settings-groups {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .settings-group {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .settings-group h3 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 1.2rem;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .family-settings {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .family-member input {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 1rem;
        }

        .notification-settings label,
        .appearance-settings label,
        .refresh-settings label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 1rem;
            color: #4a5568;
        }

        .notification-settings input[type="checkbox"],
        .appearance-settings input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .refresh-settings select {
            padding: 8px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            margin-left: 10px;
        }

        .settings-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        /* History Timeline Styles */
        .history-week-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .history-week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .history-week-header h3 {
            color: #1a202c;
            font-size: 1.3rem;
            margin: 0;
        }

        .week-summary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .history-picks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .history-pick {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .history-pick.win {
            border-color: #10b981;
            background: #ecfdf5;
        }

        .history-pick.loss {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .history-pick.no-pick {
            border-color: #9ca3af;
            background: #f3f4f6;
            opacity: 0.6;
        }

        .person-name {
            font-weight: 600;
            color: #374151;
            margin-bottom: 10px;
        }

        .pick-team {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .pick-logo {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .pick-result {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .pick-result.win {
            color: #10b981;
        }

        .pick-result.loss {
            color: #ef4444;
        }

        .pick-result.pending {
            color: #6b7280;
        }

        /* Strategy Game Cards */
        .strategy-game-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
        }

        .game-matchup {
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 8px;
        }

        .pick-recommendation,
        .safety-score,
        .value-score {
            font-size: 0.9rem;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            .tab-navigation {
                flex-wrap: wrap;
                gap: 4px;
            }

            .tab-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .strategy-cards {
                grid-template-columns: 1fr;
            }

            .analytics-grid,
            .injury-grid {
                grid-template-columns: 1fr;
            }

            .modal-team-logo {
                width: 30px;
                height: 30px;
                margin: 0 5px;
            }

            .prob-segment {
                font-size: 0.65rem;
                padding: 0 4px;
            }

            .win-probability {
                font-size: 0.8rem;
                padding: 3px 6px;
                min-width: 40px;
            }

            .game-card {
                padding: 20px;
            }

            .matchup {
                padding: 12px 0;
            }

            .betting-info {
                padding: 12px;
            }
        }

        /* Top Pick Confidence Section */
        .top-pick-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            margin: 20px 0;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .top-pick-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse-bg 3s ease-in-out infinite;
        }

        @keyframes pulse-bg {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .top-pick-header {
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .top-pick-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .top-pick-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            padding: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .top-pick-info {
            text-align: left;
        }

        .top-pick-team {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .top-pick-confidence {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .top-pick-details {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .top-pick-content {
                flex-direction: column;
                gap: 15px;
            }
            .top-pick-info {
                text-align: center;
            }
            .top-pick-logo {
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🏈 NFL Week <span id="current-week">3</span> Dashboard</h1>
            <p>Your complete eliminator pool companion</p>
            <div class="last-updated">
                <span id="last-updated-time">Last updated: Loading...</span>
                <button id="force-refresh-btn" class="btn-small">🔄 Refresh Data</button>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-navigation">
            <button class="tab-btn active" data-tab="this-week">📈 This Week</button>
            <button class="tab-btn" data-tab="history">📊 History</button>
            <button class="tab-btn" data-tab="strategy">🎯 Strategy</button>
            <button class="tab-btn" data-tab="settings">⚙️ Settings</button>
        </nav>

        <!-- Top Pick Confidence Section -->
        <div id="top-pick-section" class="top-pick-section" style="display: none;">
            <div class="top-pick-header">🎯 This Week's Top Pick</div>
            <div class="top-pick-content">
                <img id="top-pick-logo" class="top-pick-logo" src="" alt="Team Logo">
                <div class="top-pick-info">
                    <div id="top-pick-team" class="top-pick-team"></div>
                    <div id="top-pick-confidence" class="top-pick-confidence"></div>
                    <div id="top-pick-details" class="top-pick-details"></div>
                </div>
            </div>
        </div>

        <!-- This Week Tab Content -->
        <div class="tab-content active" id="this-week-tab">
            <div class="controls">

            <div class="filters">
                <button class="filter-btn active" data-filter="all">All Games</button>
                <button class="filter-btn" data-filter="large-spreads">Large Spreads (7+)</button>
                <button class="filter-btn" data-filter="close-games">Close Games (<3)</button>
                <button class="filter-btn" data-filter="weather-impact">Weather Impact</button>
                <button class="filter-btn" data-filter="high-safety" title="Games with safety scores 80+">🛡️ High Safety</button>
                <button class="filter-btn" data-filter="high-confidence" title="High confidence eliminator picks">🔥 High Confidence</button>
                <button class="filter-btn" data-filter="injury-impact" title="Games with significant injury concerns">🏥 Injury Impact</button>
                <button class="filter-btn" data-filter="home-favorites" title="Home teams favored by 3+ points">🏠 Home Favorites</button>
                <button class="filter-btn" data-filter="upset-alert" title="Games with high upset potential">🎲 Upset Alert</button>
                <button class="filter-btn" data-filter="value-plays" title="Best risk/reward ratio games">📈 Value Plays</button>
                <button class="filter-btn" data-filter="prime-time" title="Sunday/Monday Night Football">🌙 Prime Time</button>
                <button class="filter-btn" data-filter="divisional" title="Division rival matchups">🔄 Divisional</button>
            </div>

            <div class="actions">
                <button class="btn btn-secondary" id="refresh-btn">🔄 Refresh</button>
                <button class="btn btn-primary" id="add-pick-btn">➕ Add Pick</button>
            </div>
        </div>

        <div class="picks-summary">
            <div class="picks-count" id="picks-count">0/5 picks made this week</div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Loading games...</p>
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="games-container" class="games-grid"></div>

            <div class="picks-section">
                <div class="picks-header">
                    <h2>Your Picks This Week</h2>
                    <button class="btn btn-secondary" id="clear-picks-btn">Clear All</button>
                </div>
                <div id="picks-container">
                    <div class="empty-state">
                        <h3>No picks yet</h3>
                        <p>Add your eliminator pool picks to track them here</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Tab Content -->
        <div class="tab-content" id="history-tab">
            <div class="history-section">
                <div class="history-header">
                    <h2>📊 Pick History & Performance</h2>
                    <button class="btn btn-primary" id="add-historical-week-btn">+ Add Week</button>
                </div>

                <div class="week-filters">
                    <button class="filter-btn active" data-filter="all-weeks">All Weeks</button>
                    <button class="filter-btn" data-filter="recent">Recent (Last 4)</button>
                    <button class="filter-btn" data-filter="wins-only">Wins Only</button>
                    <button class="filter-btn" data-filter="losses-only">Losses Only</button>
                </div>

                <div id="history-timeline" class="history-timeline">
                    <div class="empty-state">
                        <h3>No historical data yet</h3>
                        <p>Add previous weeks' picks to track performance over time</p>
                    </div>
                </div>

            </div>
        </div>

        <!-- Strategy Tab Content -->
        <div class="tab-content" id="strategy-tab">
            <div class="strategy-section">
                <div class="strategy-header">
                    <h2>🎯 Eliminator Strategy Hub</h2>
                    <p>Advanced analytics and planning for your eliminator pool</p>
                </div>

                <div class="strategy-cards">
                    <div class="strategy-card">
                        <h3>🔥 High-Confidence Picks</h3>
                        <div id="high-confidence-games"></div>
                    </div>
                    <div class="strategy-card">
                        <h3>📈 Value Plays</h3>
                        <div id="value-plays-games"></div>
                    </div>
                    <div class="strategy-card">
                        <h3>⚠️ Risk Assessment</h3>
                        <div id="risk-assessment"></div>
                    </div>
                    <div class="strategy-card">
                        <h3>🗓️ Season Planning</h3>
                        <div id="season-planning"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab Content -->
        <div class="tab-content" id="settings-tab">
            <div class="settings-section">
                <div class="settings-header">
                    <h2>⚙️ Settings & Preferences</h2>
                    <p>Customize your NFL dashboard experience</p>
                </div>

                <div class="settings-groups">
                    <div class="settings-group">
                        <h3>👥 Family Members</h3>
                        <div class="family-settings">
                            <div class="family-member">
                                <input type="text" placeholder="Person 1 Name" class="person-name" data-person="1">
                            </div>
                            <div class="family-member">
                                <input type="text" placeholder="Person 2 Name" class="person-name" data-person="2">
                            </div>
                            <div class="family-member">
                                <input type="text" placeholder="Person 3 Name" class="person-name" data-person="3">
                            </div>
                            <div class="family-member">
                                <input type="text" placeholder="Person 4 Name" class="person-name" data-person="4">
                            </div>
                            <div class="family-member">
                                <input type="text" placeholder="Person 5 Name" class="person-name" data-person="5">
                            </div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3>🔔 Notifications</h3>
                        <div class="notification-settings">
                            <label><input type="checkbox" id="line-movement-alerts" checked> Line Movement Alerts (3+ points)</label>
                            <label><input type="checkbox" id="injury-alerts" checked> Key Injury Updates</label>
                            <label><input type="checkbox" id="game-start-alerts"> Game Start Reminders</label>
                            <label><input type="checkbox" id="morning-brief" checked> Daily Morning Brief (6 AM)</label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3>🎨 Appearance</h3>
                        <div class="appearance-settings">
                            <label><input type="checkbox" id="dark-mode"> Dark Mode</label>
                            <label><input type="checkbox" id="simplified-mode"> Simplified Mode (Less Data)</label>
                            <label><input type="checkbox" id="large-logos" checked> Large Team Logos</label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3>⏰ Data Refresh</h3>
                        <div class="refresh-settings">
                            <label>Morning Update Time:
                                <select id="refresh-time">
                                    <option value="5">5:00 AM</option>
                                    <option value="6" selected>6:00 AM</option>
                                    <option value="7">7:00 AM</option>
                                    <option value="8">8:00 AM</option>
                                </select>
                            </label>
                            <button class="btn btn-secondary" id="test-refresh">Test Refresh Now</button>
                        </div>
                    </div>
                </div>

                <div class="settings-actions">
                    <button class="btn btn-primary" id="save-settings">Save Settings</button>
                    <button class="btn btn-secondary" id="reset-settings">Reset to Defaults</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Details Modal -->
    <div id="game-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div id="game-details"></div>
        </div>
    </div>

    <!-- Add Pick Modal -->
    <div id="pick-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>Add Eliminator Pick</h2>
            <form id="pick-form">
                <div class="form-group">
                    <label for="pick-user">Your Name</label>
                    <input type="text" id="pick-user" required maxlength="30">
                </div>
                <div class="form-group">
                    <label for="pick-team">Selected Team</label>
                    <select id="pick-team" required>
                        <option value="">Choose a team...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pick-confidence">Confidence Level</label>
                    <select id="pick-confidence" required>
                        <option value="">Select confidence...</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pick-reasoning">Reasoning (optional)</label>
                    <textarea id="pick-reasoning" placeholder="Why this pick?" maxlength="140"></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary modal-close">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Pick</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        class NFLGameTracker {
            constructor() {
                this.currentWeek = 3; // Default to Week 3 as requested
                this.currentFilter = 'all';
                this.currentTab = 'this-week';
                this.games = [];
                this.picks = this.loadPicks();
                this.historicalPicks = this.loadHistoricalPicks();
                this.settings = this.loadSettings();

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupTabNavigation();
                this.detectCurrentWeek();
                this.loadGames();
                this.renderPicks();
                this.updateLastRefreshTime();
            }

            setupEventListeners() {
                // Force refresh button
                document.getElementById('force-refresh-btn').addEventListener('click', () => {
                    this.forceRefresh();
                });

                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentFilter = e.target.dataset.filter;
                        this.renderGames();
                    });
                });

                // Action buttons
                document.getElementById('refresh-btn').addEventListener('click', () => this.loadGames());
                document.getElementById('add-pick-btn').addEventListener('click', () => this.showAddPickModal());
                document.getElementById('clear-picks-btn').addEventListener('click', () => this.clearAllPicks());

                // Modal handling
                document.querySelectorAll('.modal-close').forEach(btn => {
                    btn.addEventListener('click', () => this.closeModals());
                });

                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) this.closeModals();
                    });
                });

                // Pick form
                document.getElementById('pick-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addPick();
                });
            }

            setupTabNavigation() {
                // Tab navigation
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                    });
                });
            }

            switchTab(tabName) {
                // Remove active class from all tabs and content
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                // Add active class to selected tab and content
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');

                this.currentTab = tabName;

                // Load tab-specific content
                this.loadTabContent(tabName);
            }

            loadTabContent(tabName) {
                switch(tabName) {
                    case 'history':
                        this.loadHistoryTab();
                        break;
                    case 'strategy':
                        this.loadStrategyTab();
                        break;
                    case 'settings':
                        this.loadSettingsTab();
                        break;
                    default:
                        // 'this-week' tab is already loaded
                        break;
                }
            }

            forceRefresh() {
                document.getElementById('force-refresh-btn').textContent = '🔄 Refreshing...';
                this.loadGames().finally(() => {
                    document.getElementById('force-refresh-btn').textContent = '🔄 Refresh Data';
                    this.updateLastRefreshTime();
                });
            }

            updateLastRefreshTime() {
                const now = new Date();
                const timeString = now.toLocaleString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
                document.getElementById('last-updated-time').textContent = `Last updated: ${timeString}`;
                document.getElementById('current-week').textContent = this.currentWeek;
            }

            async detectCurrentWeek() {
                try {
                    const response = await fetch('/api/current-week');
                    if (response.ok) {
                        const data = await response.json();
                        this.currentWeek = data.week;
                        this.currentSeason = data.season;
                        document.getElementById('week-select').value = data.week;
                        console.log(`Detected current week: ${data.week} of ${data.season} season`);
                    } else {
                        // Fallback to client-side detection
                        this.fallbackWeekDetection();
                    }
                } catch (error) {
                    console.error('Error detecting current week:', error);
                    this.fallbackWeekDetection();
                }
            }

            fallbackWeekDetection() {
                // Simple week detection based on date
                const now = new Date();
                const currentYear = now.getFullYear();
                const seasonStart = new Date(currentYear, 8, 5); // September 5th
                
                // Adjust for actual season start (first Thursday of September)
                while (seasonStart.getDay() !== 4) { // Thursday is day 4
                    seasonStart.setDate(seasonStart.getDate() + 1);
                }
                
                if (now < seasonStart) {
                    this.currentWeek = 1;
                } else {
                    const weeksSinceStart = Math.floor((now - seasonStart) / (7 * 24 * 60 * 60 * 1000)) + 1;
                    this.currentWeek = Math.min(Math.max(weeksSinceStart, 1), 18);
                }
                
                document.getElementById('week-select').value = this.currentWeek;
                console.log(`Fallback week detection: Week ${this.currentWeek}`);
            }

            // Helper function to properly format team records
            getTeamRecord(team) {
                if (!team || !team.record) {
                    return '0-0';
                }
                
                // If record is already a string, return it
                if (typeof team.record === 'string') {
                    return team.record;
                }
                
                // If record is an object with wins/losses, format it
                if (team.record.wins !== undefined && team.record.losses !== undefined) {
                    return `${team.record.wins}-${team.record.losses}`;
                }
                
                // Fallback for any other format
                return '0-0';
            }

            // Helper function for accessible probability colors
            getProbabilityColor(probability) {
                if (probability >= 75) return '#047857'; // Dark green for very high
                if (probability >= 65) return '#1e40af'; // Dark blue for high
                if (probability >= 55) return '#b45309'; // Dark orange for medium
                return '#b91c1c'; // Dark red for low
            }

            getProbabilityBackgroundColor(probability) {
                if (probability >= 75) return '#d1fae5'; // Light green background
                if (probability >= 65) return '#dbeafe'; // Light blue background
                if (probability >= 55) return '#fef3c7'; // Light orange background
                return '#fee2e2'; // Light red background
            }

            async loadGames() {
                this.showLoading(true);
                this.hideError();

                try {
                    const response = await fetch(`/api/games/${this.currentWeek}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    this.games = await response.json();
                    // Sort games by confidence score (highest to lowest)
                    this.sortGamesByConfidence();
                    this.updateTopPick();
                    this.renderGames();
                    this.populateTeamSelect();
                    
                } catch (error) {
                    console.error('Error loading games:', error);
                    this.showError('Failed to load games. Please check your connection and try again.');
                } finally {
                    this.showLoading(false);
                }
            }

            renderGames() {
                const container = document.getElementById('games-container');
                
                if (this.games.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No games available</h3>
                            <p>Games for Week ${this.currentWeek} are not yet available.</p>
                        </div>
                    `;
                    return;
                }

                const filteredGames = this.filterGames(this.games);
                
                if (filteredGames.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No games match filter</h3>
                            <p>Try selecting a different filter to see games.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredGames.map(game => this.renderGameCard(game)).join('');

                // Add click listeners to game cards
                container.querySelectorAll('.game-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const gameId = card.dataset.gameId;
                        this.showGameDetails(gameId);
                    });
                });
            }

            filterGames(games) {
                switch (this.currentFilter) {
                    case 'large-spreads':
                        return games.filter(game => Math.abs(game.spread) >= 7);
                    case 'close-games':
                        return games.filter(game => Math.abs(game.spread) < 3);
                    case 'weather-impact':
                        return games.filter(game => 
                            !game.weather.indoor && 
                            (game.weather.condition === 'Snow' || 
                             game.weather.condition === 'Rain' || 
                             game.weather.wind > 15)
                        );
                    case 'high-safety':
                        return games.filter(game => 
                            game.eliminator && game.eliminator.safety_score >= 80
                        );
                    case 'high-confidence':
                        return games.filter(game => 
                            game.eliminator && game.eliminator.confidence === 'high'
                        );
                    case 'injury-impact':
                        return games.filter(game => 
                            game.injuries && (
                                (game.injuries.impact_score && game.injuries.impact_score > 6) ||
                                (game.injuries.away_team && game.injuries.away_team.length >= 3) ||
                                (game.injuries.home_team && game.injuries.home_team.length >= 3)
                            )
                        );
                    case 'home-favorites':
                        return games.filter(game => 
                            game.favorite === 'home' && Math.abs(game.spread) >= 3
                        );
                    case 'upset-alert':
                        return games.filter(game => 
                            game.eliminator && (
                                (game.eliminator.risk_factors && game.eliminator.risk_factors.length > 2) ||
                                (game.eliminator.safety_score < 60 && Math.abs(game.spread) < 7)
                            )
                        );
                    case 'value-plays':
                        return games.filter(game => 
                            game.eliminator && game.eliminator.value_score > 75
                        );
                    case 'prime-time':
                        return games.filter(game => {
                            const gameDate = new Date(game.date);
                            const hour = gameDate.getHours();
                            const dayOfWeek = gameDate.getDay();
                            // Sunday (0) or Monday (1) games after 7 PM
                            return (dayOfWeek === 0 || dayOfWeek === 1) && hour >= 19;
                        });
                    case 'divisional':
                        return games.filter(game => 
                            game.divisional === true
                        );
                    default:
                        return games;
                }
            }

            sortGamesByConfidence() {
                if (!this.games || this.games.length === 0) return;

                // Define confidence levels and their numeric values
                const confidenceValues = {
                    'very_high': 100,
                    'high': 80,
                    'medium': 50,
                    'low': 20
                };

                this.games.sort((a, b) => {
                    const aConfidence = a.eliminator?.confidence || 'low';
                    const bConfidence = b.eliminator?.confidence || 'low';
                    const aSafetyScore = a.eliminator?.safety_score || 0;
                    const bSafetyScore = b.eliminator?.safety_score || 0;

                    // Primary sort: confidence level
                    const aValue = confidenceValues[aConfidence] || 0;
                    const bValue = confidenceValues[bConfidence] || 0;

                    if (aValue !== bValue) {
                        return bValue - aValue; // Higher confidence first
                    }

                    // Secondary sort: safety score
                    return bSafetyScore - aSafetyScore;
                });
            }

            updateTopPick() {
                const topPickSection = document.getElementById('top-pick-section');

                if (!this.games || this.games.length === 0) {
                    topPickSection.style.display = 'none';
                    return;
                }

                // Find the highest confidence game
                const topGame = this.games[0]; // Already sorted by confidence

                if (!topGame.eliminator || topGame.eliminator.confidence === 'low') {
                    topPickSection.style.display = 'none';
                    return;
                }

                // Show and populate the top pick section
                topPickSection.style.display = 'block';

                const recommendedTeam = topGame.eliminator.recommended_team;
                const isHomeRecommended = recommendedTeam === topGame.home_team.abbr;
                const teamData = isHomeRecommended ? topGame.home_team : topGame.away_team;

                // Update the content
                document.getElementById('top-pick-logo').src = teamData.logo;
                document.getElementById('top-pick-team').textContent = teamData.name;
                document.getElementById('top-pick-confidence').textContent =
                    `${Math.round(topGame.eliminator.safety_score || 0)}% Confidence`;

                const spread = Math.abs(topGame.spread);
                const details = `vs ${isHomeRecommended ? topGame.away_team.name : topGame.home_team.name} • ${spread} pt favorite`;
                document.getElementById('top-pick-details').textContent = details;
            }

            renderGameCard(game) {
                const gameTime = new Date(game.date).toLocaleString('en-US', {
                    weekday: 'short',
                    month: 'short', 
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });

                const spreadText = game.spread > 0 ? `+${game.spread}` : game.spread;
                const spreadClass = Math.abs(game.spread) >= 7 ? 'spread-large' : 
                                  Math.abs(game.spread) < 3 ? 'spread-close' : '';
                
                const weatherWarning = !game.weather.indoor && 
                    (game.weather.condition === 'Snow' || game.weather.condition === 'Rain') && 
                    game.weather.wind > 15;

                return `
                    <div class="game-card" data-game-id="${game.id}" data-confidence="${game.eliminator?.confidence || 'low'}">
                        <div class="game-header">
                            <span class="game-time">${gameTime}</span>
                            <span class="game-status status-${game.status}">${game.status}</span>
                        </div>

                        <div class="matchup">
                            <div class="team">
                                <div style="position: relative; display: inline-block;">
                                    <img src="${game.away_team.logo || `https://a.espncdn.com/i/teamlogos/nfl/500/${game.away_team.abbr.toLowerCase()}.png`}" 
                                         alt="${game.away_team.name} logo" 
                                         class="team-logo"
                                         onerror="this.style.display='none'">
                                    ${game.injuries && game.injuries.away_team && game.injuries.away_team.length > 0 ? 
                                        `<div class="injury-indicator" title="${game.injuries.away_team.length} injuries">${game.injuries.away_team.length}</div>` : ''}
                                </div>
                                <div class="team-name">${game.away_team.abbr}</div>
                                <div class="team-record">${this.getTeamRecord(game.away_team)}</div>
                                ${game.status !== 'pregame' ? `<div class="team-score">${game.away_score}</div>` : ''}
                                ${game.probabilities ? `<div class="win-probability away-prob" style="background-color: ${this.getProbabilityBackgroundColor(game.probabilities.away_probability)}; color: ${this.getProbabilityColor(game.probabilities.away_probability)};">${game.probabilities.away_probability}%</div>` : ''}
                            </div>
                            <div class="vs">@</div>
                            <div class="team">
                                <div style="position: relative; display: inline-block;">
                                    <img src="${game.home_team.logo || `https://a.espncdn.com/i/teamlogos/nfl/500/${game.home_team.abbr.toLowerCase()}.png`}" 
                                         alt="${game.home_team.name} logo" 
                                         class="team-logo"
                                         onerror="this.style.display='none'">
                                    ${game.injuries && game.injuries.home_team && game.injuries.home_team.length > 0 ? 
                                        `<div class="injury-indicator" title="${game.injuries.home_team.length} injuries">${game.injuries.home_team.length}</div>` : ''}
                                </div>
                                <div class="team-name">${game.home_team.abbr}</div>
                                <div class="team-record">${this.getTeamRecord(game.home_team)}</div>
                                ${game.status !== 'pregame' ? `<div class="team-score">${game.home_score}</div>` : ''}
                                ${game.probabilities ? `<div class="win-probability home-prob" style="background-color: ${this.getProbabilityBackgroundColor(game.probabilities.home_probability)}; color: ${this.getProbabilityColor(game.probabilities.home_probability)};">${game.probabilities.home_probability}%</div>` : ''}
                            </div>
                        </div>

                        <div class="betting-info">
                            <div class="betting-row">
                                <span class="betting-label">Spread:</span>
                                <span class="betting-value ${spreadClass}">
                                    ${game.favorite === 'home' ? game.home_team.abbr : game.away_team.abbr} ${spreadText}
                                </span>
                            </div>
                            <div class="betting-row">
                                <span class="betting-label">O/U:</span>
                                <span class="betting-value">${game.over_under}</span>
                            </div>
                        </div>

                        <div class="weather-info ${weatherWarning ? 'weather-warning' : ''}">
                            <span class="weather-temp">${game.weather.indoor ? 'Played in Dome' : game.weather.temp + '°F'}</span>
                            ${!game.weather.indoor ? `<span class="weather-condition">${game.weather.condition}</span>` : ''}
                            ${!game.weather.indoor && game.weather.wind > 10 ? `<span>${game.weather.wind}mph wind</span>` : ''}
                        </div>

                        ${game.probabilities ? `
                            <div class="probability-section">
                                <div class="probability-bar-container">
                                    <div class="probability-bar">
                                        <div class="prob-segment away-segment" 
                                             style="width: ${game.probabilities.away_probability}%; background-color: ${this.getProbabilityColor(game.probabilities.away_probability)}; color: white; font-weight: 600;">
                                            ${game.away_team.abbr} ${game.probabilities.away_probability}%
                                        </div>
                                        <div class="prob-segment home-segment" 
                                             style="width: ${game.probabilities.home_probability}%; background-color: ${this.getProbabilityColor(game.probabilities.home_probability)}; color: white; font-weight: 600;">
                                            ${game.home_team.abbr} ${game.probabilities.home_probability}%
                                        </div>
                                    </div>
                                </div>
                                <div class="probability-method">
                                    ${game.probabilities.method === 'moneyline' ? '📈 Real Odds' : '📊 Estimated'}
                                </div>
                            </div>
                        ` : ''}

                        <div class="eliminator-rec">
                            <div class="rec-header">
                                <span class="rec-team">Pick: ${game.eliminator.recommended_team}</span>
                                <span class="confidence-badge confidence-${game.eliminator.confidence}">
                                    ${game.eliminator.confidence}
                                </span>
                                <span class="safety-score" title="Safety Score: ${Math.round(game.eliminator.safety_score || 0)}/100">
                                    🛡️ ${Math.round(game.eliminator.safety_score || 0)}
                                </span>
                            </div>
                            ${game.eliminator.reasons.length > 0 ? `
                                <div class="rec-reasons">
                                    <ul>
                                        ${game.eliminator.reasons.slice(0, 2).map(reason => `<li>${reason}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            ${game.eliminator.warnings.length > 0 ? `
                                <div class="rec-warnings">
                                    ⚠️ ${game.eliminator.warnings.slice(0, 1).join(', ')}
                                </div>
                            ` : ''}
                        </div>

                        ${game.injuries && game.injuries.warnings && game.injuries.warnings.length > 0 ? `
                            <div class="injury-warning">
                                🏥 ${game.injuries.warnings.join(', ')}
                            </div>
                        ` : ''}

                        <div class="venue">${game.venue}</div>
                    </div>
                `;
            }

            showGameDetails(gameId) {
                const game = this.games.find(g => g.id === gameId);
                if (!game) return;

                const modal = document.getElementById('game-modal');
                const details = document.getElementById('game-details');
                
                details.innerHTML = `
                    <h2>
                        <img src="${game.away_team.logo || `https://a.espncdn.com/i/teamlogos/nfl/500/${game.away_team.abbr.toLowerCase()}.png`}" 
                             alt="${game.away_team.name} logo" 
                             class="modal-team-logo"
                             onerror="this.style.display='none'">
                        ${game.away_team.name} @ ${game.home_team.name}
                        <img src="${game.home_team.logo || `https://a.espncdn.com/i/teamlogos/nfl/500/${game.home_team.abbr.toLowerCase()}.png`}" 
                             alt="${game.home_team.name} logo" 
                             class="modal-team-logo"
                             onerror="this.style.display='none'">
                    </h2>
                    
                    <div class="matchup">
                        <div class="team">
                            <div class="team-name">${game.away_team.name} (${game.away_team.record})</div>
                            ${game.status !== 'pregame' ? `<div class="team-score">${game.away_score}</div>` : ''}
                        </div>
                        <div class="vs">@</div>
                        <div class="team">
                            <div class="team-name">${game.home_team.name} (${game.home_team.record})</div>
                            ${game.status !== 'pregame' ? `<div class="team-score">${game.home_score}</div>` : ''}
                        </div>
                    </div>

                    ${game.probabilities ? `
                        <div class="analytics-section">
                            <h3>🎯 Win Probabilities</h3>
                            <div class="probability-bar-container" style="margin-bottom: 10px;">
                                <div class="probability-bar" style="height: 40px; font-size: 0.9rem;">
                                    <div class="prob-segment away-segment" 
                                         style="width: ${game.probabilities.away_probability}%; background: ${this.getProbabilityColor(game.probabilities.away_probability)}; color: white; font-weight: 600;">
                                        ${game.away_team.name} ${game.probabilities.away_probability}%
                                    </div>
                                    <div class="prob-segment home-segment" 
                                         style="width: ${game.probabilities.home_probability}%; background: ${this.getProbabilityColor(game.probabilities.home_probability)}; color: white; font-weight: 600;">
                                        ${game.home_team.name} ${game.probabilities.home_probability}%
                                    </div>
                                </div>
                            </div>
                            <div class="stat-row">
                                <span>Data Source:</span>
                                <span>${game.probabilities.method === 'moneyline' ? '📈 Real Betting Odds' : '📊 Estimated from Spread'}</span>
                            </div>
                            <div class="stat-row">
                                <span>Confidence Level:</span>
                                <span class="confidence-badge confidence-${game.probabilities.confidence_level}">${game.probabilities.confidence_level.replace('_', ' ')}</span>
                            </div>
                        </div>
                    ` : ''}

                    ${game.analytics ? `
                        <div class="analytics-section">
                            <h3>📊 Team Analytics</h3>
                            <div class="analytics-grid">
                                <div class="team-analytics">
                                    <h4>${game.away_team.abbr} (Away)</h4>
                                    <div class="stat-row">
                                        <span>Offensive Rank:</span>
                                        <span>#${game.analytics.away_team?.offensive_ranking || 'N/A'}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span>Defensive Rank:</span>
                                        <span>#${game.analytics.away_team?.defensive_ranking || 'N/A'}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span>Points/Game:</span>
                                        <span>${game.analytics.away_team?.points_per_game || 'N/A'}</span>
                                    </div>
                                </div>
                                <div class="team-analytics">
                                    <h4>${game.home_team.abbr} (Home)</h4>
                                    <div class="stat-row">
                                        <span>Offensive Rank:</span>
                                        <span>#${game.analytics.home_team?.offensive_ranking || 'N/A'}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span>Defensive Rank:</span>
                                        <span>#${game.analytics.home_team?.defensive_ranking || 'N/A'}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span>Points/Game:</span>
                                        <span>${game.analytics.home_team?.points_per_game || 'N/A'}</span>
                                    </div>
                                </div>
                            </div>
                            ${game.analytics.matchup_advantages && game.analytics.matchup_advantages.length > 0 ? `
                                <div class="matchup-advantages">
                                    <strong>🔥 Key Advantages:</strong>
                                    <ul>
                                        ${game.analytics.matchup_advantages.map(advantage => `<li>${advantage}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}

                    ${game.injuries && (game.injuries.home_team?.length > 0 || game.injuries.away_team?.length > 0) ? `
                        <div class="injury-section">
                            <h3>🏥 Injury Report</h3>
                            <div class="injury-grid">
                                ${game.injuries.away_team?.length > 0 ? `
                                    <div class="team-injuries">
                                        <h4>${game.away_team.abbr} Injuries</h4>
                                        <ul>
                                            ${game.injuries.away_team.slice(0, 3).map(injury => `
                                                <li>${injury.player} - ${injury.position} (${injury.status})</li>
                                            `).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                ${game.injuries.home_team?.length > 0 ? `
                                    <div class="team-injuries">
                                        <h4>${game.home_team.abbr} Injuries</h4>
                                        <ul>
                                            ${game.injuries.home_team.slice(0, 3).map(injury => `
                                                <li>${injury.player} - ${injury.position} (${injury.status})</li>
                                            `).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                            ${game.injuries.impact_score ? `
                                <div class="injury-impact">
                                    Impact Score: <span class="impact-badge impact-${game.injuries.impact_score > 7 ? 'high' : game.injuries.impact_score > 4 ? 'medium' : 'low'}">${game.injuries.impact_score}/10</span>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}

                    ${game.news && game.news.length > 0 ? `
                        <div class="news-section">
                            <h3>📰 Latest News</h3>
                            ${game.news.map(article => `
                                <div class="news-item">
                                    <div class="news-headline">${article.headline}</div>
                                    <div class="news-description">${article.description}</div>
                                    <div class="news-source">${article.source}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}

                    <div class="betting-info">
                        <h3>💰 Betting Information</h3>
                        <div class="betting-row">
                            <span class="betting-label">Point Spread:</span>
                            <span class="betting-value">${game.favorite === 'home' ? game.home_team.abbr : game.away_team.abbr} ${game.spread}</span>
                        </div>
                        <div class="betting-row">
                            <span class="betting-label">Over/Under:</span>
                            <span class="betting-value">${game.over_under}</span>
                        </div>
                    </div>

                    <div class="weather-info">
                        <h3>🌤️ Weather Conditions</h3>
                        <p>
                            ${game.weather.indoor ? 'Played in Dome' : `${game.weather.temp}°F, ${game.weather.condition}`}
                            ${game.weather.wind > 10 ? `, ${game.weather.wind}mph winds` : ''}
                        </p>
                    </div>

                    <div class="eliminator-rec">
                        <h3>🎯 Eliminator Recommendation</h3>
                        <div class="rec-header">
                            <span class="rec-team">Recommended: ${game.eliminator.recommended_team}</span>
                            <span class="confidence-badge confidence-${game.eliminator.confidence}">
                                ${game.eliminator.confidence} confidence
                            </span>
                        </div>
                        ${game.eliminator.reasons.length > 0 ? `
                            <div class="rec-reasons">
                                <strong>Reasons:</strong>
                                <ul>
                                    ${game.eliminator.reasons.map(reason => `<li>${reason}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        ${game.eliminator.warnings.length > 0 ? `
                            <div class="rec-warnings">
                                <strong>Warnings:</strong> ${game.eliminator.warnings.join(', ')}
                            </div>
                        ` : ''}
                    </div>

                    <div class="venue">
                        <strong>🏟️ Venue:</strong> ${game.venue}
                    </div>
                `;

                modal.style.display = 'block';
            }

            showAddPickModal() {
                document.getElementById('pick-modal').style.display = 'block';
            }

            closeModals() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
                this.resetPickForm();
            }

            populateTeamSelect() {
                const select = document.getElementById('pick-team');
                const teams = new Set();
                
                this.games.forEach(game => {
                    teams.add(`${game.home_team.abbr}|${game.home_team.name}`);
                    teams.add(`${game.away_team.abbr}|${game.away_team.name}`);
                });

                const sortedTeams = Array.from(teams).sort();
                
                select.innerHTML = '<option value="">Choose a team...</option>' +
                    sortedTeams.map(team => {
                        const [abbr, name] = team.split('|');
                        return `<option value="${abbr}">${name} (${abbr})</option>`;
                    }).join('');
            }

            addPick() {
                const user = document.getElementById('pick-user').value.trim();
                const team = document.getElementById('pick-team').value;
                const confidence = document.getElementById('pick-confidence').value;
                const reasoning = document.getElementById('pick-reasoning').value.trim();

                // Validation
                if (!user || !team || !confidence) {
                    alert('Please fill in all required fields.');
                    return;
                }

                // Check for duplicate user
                if (this.picks.some(pick => pick.user === user && pick.week === this.currentWeek)) {
                    alert(`${user} already has a pick for Week ${this.currentWeek}. Edit the existing pick instead.`);
                    return;
                }

                // Check max picks limit
                const weekPicks = this.picks.filter(pick => pick.week === this.currentWeek);
                if (weekPicks.length >= 5) {
                    alert('Maximum of 5 picks per week allowed.');
                    return;
                }

                const pick = {
                    id: Date.now().toString(),
                    week: this.currentWeek,
                    user,
                    team,
                    confidence,
                    reasoning,
                    timestamp: new Date().toISOString()
                };

                this.picks.push(pick);
                this.savePicks();
                this.renderPicks();
                this.closeModals();
            }

            renderPicks() {
                const container = document.getElementById('picks-container');
                const weekPicks = this.picks.filter(pick => pick.week === this.currentWeek);
                
                // Update picks count
                document.getElementById('picks-count').textContent = `${weekPicks.length}/5 picks made this week`;

                if (weekPicks.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No picks yet</h3>
                            <p>Add your eliminator pool picks to track them here</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = weekPicks
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .map(pick => `
                        <div class="pick-card">
                            <div class="pick-info">
                                <div class="pick-user">${pick.user}</div>
                                <div class="pick-team">${pick.team}</div>
                                <div class="confidence-badge confidence-${pick.confidence}">${pick.confidence}</div>
                                ${pick.reasoning ? `<div class="pick-reasoning">"${pick.reasoning}"</div>` : ''}
                            </div>
                            <div class="pick-actions">
                                <button class="btn btn-secondary" onclick="nflTracker.editPick('${pick.id}')">Edit</button>
                                <button class="btn btn-danger" onclick="nflTracker.deletePick('${pick.id}')">Delete</button>
                            </div>
                        </div>
                    `).join('');
            }

            editPick(pickId) {
                const pick = this.picks.find(p => p.id === pickId);
                if (!pick) return;

                // Populate form with existing data
                document.getElementById('pick-user').value = pick.user;
                document.getElementById('pick-team').value = pick.team;
                document.getElementById('pick-confidence').value = pick.confidence;
                document.getElementById('pick-reasoning').value = pick.reasoning || '';

                // Remove the old pick
                this.picks = this.picks.filter(p => p.id !== pickId);
                this.savePicks();
                
                this.showAddPickModal();
            }

            deletePick(pickId) {
                if (confirm('Are you sure you want to delete this pick?')) {
                    this.picks = this.picks.filter(pick => pick.id !== pickId);
                    this.savePicks();
                    this.renderPicks();
                }
            }

            clearAllPicks() {
                const weekPicks = this.picks.filter(pick => pick.week === this.currentWeek);
                if (weekPicks.length === 0) return;

                if (confirm(`Are you sure you want to delete all ${weekPicks.length} picks for Week ${this.currentWeek}?`)) {
                    this.picks = this.picks.filter(pick => pick.week !== this.currentWeek);
                    this.savePicks();
                    this.renderPicks();
                }
            }

            resetPickForm() {
                document.getElementById('pick-form').reset();
            }

            loadPicks() {
                try {
                    const saved = localStorage.getItem('nfl-tracker-picks');
                    return saved ? JSON.parse(saved) : [];
                } catch (error) {
                    console.error('Error loading picks:', error);
                    return [];
                }
            }

            savePicks() {
                try {
                    localStorage.setItem('nfl-tracker-picks', JSON.stringify(this.picks));
                } catch (error) {
                    console.error('Error saving picks:', error);
                }
            }

            showLoading(show) {
                document.getElementById('loading').style.display = show ? 'block' : 'none';
                document.getElementById('games-container').style.display = show ? 'none' : 'grid';
            }

            showError(message) {
                const errorDiv = document.getElementById('error');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }

            hideError() {
                document.getElementById('error').style.display = 'none';
            }

            // History Tab Methods
            loadHistoryTab() {
                this.renderHistoryTimeline();
                this.setupHistoryEventListeners();
            }

            setupHistoryEventListeners() {
                // Add historical week button
                const addBtn = document.getElementById('add-historical-week-btn');
                if (addBtn) {
                    addBtn.addEventListener('click', () => this.showAddHistoricalWeekModal());
                }

                // Week filter buttons
                document.querySelectorAll('.week-filters .filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.week-filters .filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.filterHistoryTimeline(e.target.dataset.filter);
                    });
                });
            }

            renderHistoryTimeline() {
                const container = document.getElementById('history-timeline');
                const historical = this.historicalPicks;

                if (!historical || historical.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No historical data yet</h3>
                            <p>Add previous weeks' picks to track performance over time</p>
                        </div>
                    `;
                    return;
                }

                // Group picks by week
                const weeklyPicks = {};
                historical.forEach(pick => {
                    if (!weeklyPicks[pick.week]) {
                        weeklyPicks[pick.week] = [];
                    }
                    weeklyPicks[pick.week].push(pick);
                });

                // Render timeline
                const timelineHtml = Object.keys(weeklyPicks)
                    .sort((a, b) => parseInt(b) - parseInt(a))
                    .map(week => this.renderHistoryWeek(week, weeklyPicks[week]))
                    .join('');

                container.innerHTML = timelineHtml;
            }

            renderHistoryWeek(week, picks) {
                const personNames = this.getPersonNames();

                return `
                    <div class="history-week-card">
                        <div class="history-week-header">
                            <h3>Week ${week}</h3>
                            <div class="week-summary">
                                ${picks.filter(p => p.result === 'win').length}W - ${picks.filter(p => p.result === 'loss').length}L
                            </div>
                        </div>
                        <div class="history-picks-grid">
                            ${personNames.map((name, index) => {
                                const pick = picks.find(p => p.person === index + 1);
                                return this.renderHistoryPick(name, pick);
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            renderHistoryPick(personName, pick) {
                if (!pick) {
                    return `
                        <div class="history-pick no-pick">
                            <div class="person-name">${personName}</div>
                            <div class="pick-result">No Pick</div>
                        </div>
                    `;
                }

                const resultClass = pick.result === 'win' ? 'win' : pick.result === 'loss' ? 'loss' : 'pending';
                const logoUrl = `https://a.espncdn.com/i/teamlogos/nfl/500/${pick.team.toLowerCase()}.png`;

                return `
                    <div class="history-pick ${resultClass}">
                        <div class="person-name">${personName}</div>
                        <div class="pick-team">
                            <img src="${logoUrl}" alt="${pick.team}" class="pick-logo" onerror="this.style.display='none'">
                            <span>${pick.team}</span>
                        </div>
                        <div class="pick-result ${resultClass}">
                            ${pick.result === 'win' ? '✅' : pick.result === 'loss' ? '❌' : '⏳'}
                        </div>
                    </div>
                `;
            }

            // Strategy Tab Methods
            loadStrategyTab() {
                this.loadHighConfidenceGames();
                this.loadValuePlays();
                this.loadRiskAssessment();
                this.loadSeasonPlanning();
            }

            async loadHighConfidenceGames() {
                const highConfidenceGames = this.games.filter(game =>
                    game.eliminator && game.eliminator.confidence === 'high'
                );

                const container = document.getElementById('high-confidence-games');
                if (highConfidenceGames.length === 0) {
                    container.innerHTML = '<p>No high-confidence games this week</p>';
                    return;
                }

                container.innerHTML = highConfidenceGames.map(game => `
                    <div class="strategy-game-card">
                        <div class="game-matchup">
                            ${game.away_team.abbr} @ ${game.home_team.abbr}
                        </div>
                        <div class="pick-recommendation">
                            Pick: ${game.eliminator.recommended_team}
                        </div>
                        <div class="safety-score">
                            Safety: ${Math.round(game.eliminator.safety_score || 0)}
                        </div>
                    </div>
                `).join('');
            }

            async loadValuePlays() {
                const valueGames = this.games.filter(game =>
                    game.eliminator && game.eliminator.value_score > 75
                );

                const container = document.getElementById('value-plays-games');
                container.innerHTML = valueGames.length > 0 ?
                    valueGames.map(game => `
                        <div class="strategy-game-card">
                            <div class="game-matchup">
                                ${game.away_team.abbr} @ ${game.home_team.abbr}
                            </div>
                            <div class="value-score">
                                Value: ${Math.round(game.eliminator.value_score || 0)}
                            </div>
                        </div>
                    `).join('') : '<p>No high-value plays identified this week</p>';
            }

            async loadRiskAssessment() {
                const riskyGames = this.games.filter(game =>
                    game.eliminator && game.eliminator.safety_score < 60
                );

                const container = document.getElementById('risk-assessment');
                container.innerHTML = riskyGames.length > 0 ?
                    `<p><strong>⚠️ ${riskyGames.length} games</strong> have elevated risk this week</p>` :
                    '<p>✅ No high-risk games identified this week</p>';
            }

            async loadSeasonPlanning() {
                const container = document.getElementById('season-planning');
                container.innerHTML = `
                    <p>📊 Season planning data loading...</p>
                    <p>🎯 Weeks remaining: ${18 - this.currentWeek}</p>
                    <p>💡 Strategy: Save elite teams for difficult weeks</p>
                `;
            }

            // Settings Tab Methods
            loadSettingsTab() {
                this.loadPersonNames();
                this.loadNotificationSettings();
                this.setupSettingsEventListeners();
            }

            loadPersonNames() {
                const names = this.getPersonNames();
                names.forEach((name, index) => {
                    const input = document.querySelector(`[data-person="${index + 1}"]`);
                    if (input) {
                        input.value = name;
                    }
                });
            }

            loadNotificationSettings() {
                // Load notification preferences from settings
                const settings = this.settings;
                document.getElementById('line-movement-alerts').checked = settings.lineMovementAlerts !== false;
                document.getElementById('injury-alerts').checked = settings.injuryAlerts !== false;
                document.getElementById('game-start-alerts').checked = settings.gameStartAlerts === true;
                document.getElementById('morning-brief').checked = settings.morningBrief !== false;
            }

            setupSettingsEventListeners() {
                // Save settings button
                document.getElementById('save-settings').addEventListener('click', () => {
                    this.saveSettings();
                });

                // Reset settings button
                document.getElementById('reset-settings').addEventListener('click', () => {
                    this.resetSettings();
                });
            }

            saveSettings() {
                // Save person names
                const names = [];
                for (let i = 1; i <= 5; i++) {
                    const input = document.querySelector(`[data-person="${i}"]`);
                    names.push(input.value || `Person ${i}`);
                }

                // Save notification settings
                this.settings = {
                    personNames: names,
                    lineMovementAlerts: document.getElementById('line-movement-alerts').checked,
                    injuryAlerts: document.getElementById('injury-alerts').checked,
                    gameStartAlerts: document.getElementById('game-start-alerts').checked,
                    morningBrief: document.getElementById('morning-brief').checked,
                    refreshTime: document.getElementById('refresh-time').value
                };

                localStorage.setItem('nfl-tracker-settings', JSON.stringify(this.settings));
                alert('Settings saved successfully!');
            }

            resetSettings() {
                if (confirm('Reset all settings to defaults?')) {
                    localStorage.removeItem('nfl-tracker-settings');
                    this.settings = {};
                    this.loadSettingsTab();
                    alert('Settings reset to defaults');
                }
            }

            // Utility Methods
            loadSettings() {
                try {
                    const saved = localStorage.getItem('nfl-tracker-settings');
                    return saved ? JSON.parse(saved) : {};
                } catch (error) {
                    console.error('Error loading settings:', error);
                    return {};
                }
            }

            loadHistoricalPicks() {
                try {
                    const saved = localStorage.getItem('nfl-tracker-historical');
                    return saved ? JSON.parse(saved) : [];
                } catch (error) {
                    console.error('Error loading historical picks:', error);
                    return [];
                }
            }

            getPersonNames() {
                if (this.settings.personNames) {
                    return this.settings.personNames;
                }
                return ['Person 1', 'Person 2', 'Person 3', 'Person 4', 'Person 5'];
            }

            filterHistoryTimeline(filter) {
                // Implementation for filtering historical data
                console.log('Filtering history by:', filter);
            }

            showAddHistoricalWeekModal() {
                // Implementation for adding historical week data
                alert('Add Historical Week modal - Coming soon!');
            }
        }

        // Initialize the app
        const nflTracker = new NFLGameTracker();
        
        // Make it globally accessible for onclick handlers
        window.nflTracker = nflTracker;
    </script>
</body>
</html>