<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Game Tracker</title>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            color: #1a202c;
            font-size: 16px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            color: #1a202c;
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            color: #4a5568;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .last-updated {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .btn-small {
            padding: 6px 12px;
            border: 1px solid #cbd5e0;
            background: white;
            color: #4a5568;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .btn-small:hover {
            background: #f7fafc;
            border-color: #667eea;
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 30px;
            background: white;
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: #6b7280;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: #f8fafc;
            color: #4a5568;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .controls {
            background: white;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: space-between;
        }

        .week-selector {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-bottom: 20px;
            border: 3px solid #4299e1;
        }

        .week-selector label {
            font-weight: 700;
            color: white;
            font-size: 1.4rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
        }

        .week-selector .week-prompt {
            color: #f7fafc;
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 500;
        }

        .week-selector select {
            padding: 15px 25px;
            border: 3px solid #4299e1;
            border-radius: 10px;
            font-size: 1.3rem;
            font-weight: 600;
            background: white;
            cursor: pointer;
            min-width: 180px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .week-selector select:focus {
            outline: none;
            border-color: #2b6cb0;
            transform: scale(1.05);
            box-shadow: 0 4px 16px rgba(66, 153, 225, 0.4);
        }

        .week-selector select:hover {
            transform: scale(1.02);
            border-color: #3182ce;
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 18px;
            border: 2px solid #cbd5e0;
            background: white;
            color: #2d3748;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: #f7fafc;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #cbd5e0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #a0aec0;
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
        }

        .btn-danger:hover {
            background: #c53030;
        }

        .picks-summary {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .picks-count {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .game-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 8px;
            border: 2px solid #e2e8f0;
        }

        .game-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border-color: #cbd5e0;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 12px 16px;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 8px;
            margin: -16px -16px 8px -16px;
        }

        .game-time {
            font-size: 0.95rem;
            color: #4a5568;
            font-weight: 600;
        }

        .game-status {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pregame {
            background: #e2e8f0;
            color: #4a5568;
        }

        .status-in_progress {
            background: #fee2e2;
            color: #dc2626;
        }

        .status-final {
            background: #d1fae5;
            color: #059669;
        }

        .game-status {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pregame {
            background: #e6fffa;
            color: #319795;
        }

        .status-live {
            background: #fed7d7;
            color: #e53e3e;
        }

        .status-final {
            background: #e2e8f0;
            color: #4a5568;
        }

        .matchup {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 20px 0;
            background: #ffffff;
            border-radius: 12px;
            border: 1px solid #f1f5f9;
        }

        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .team-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-bottom: 8px;
            border: 3px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }

        .team-logo:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Recommended Team Glow Effects */
        .game-card[data-confidence="high"] .team-logo,
        .game-card[data-confidence="very_high"] .team-logo {
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
            animation: gentle-pulse 2s ease-in-out infinite;
        }

        .game-card[data-confidence="high"] .eliminator-rec,
        .game-card[data-confidence="very_high"] .eliminator-rec {
            box-shadow: 0 4px 20px rgba(5, 150, 105, 0.3);
            border: 1px solid rgba(5, 150, 105, 0.2);
            animation: glow-border 3s ease-in-out infinite;
        }

        @keyframes gentle-pulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 30px rgba(102, 126, 234, 0.6);
                transform: scale(1.02);
            }
        }

        @keyframes glow-border {
            0%, 100% {
                box-shadow: 0 4px 20px rgba(5, 150, 105, 0.3);
            }
            50% {
                box-shadow: 0 6px 30px rgba(5, 150, 105, 0.5);
            }
        }

        .team-name {
            font-weight: 800;
            font-size: 1.2rem;
            text-align: center;
            margin-top: 8px;
            color: #1a202c;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .team-record {
            font-size: 1rem;
            color: #6b7280;
            margin-top: 4px;
            font-weight: 600;
            background: #f3f4f6;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .team-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin-top: 5px;
        }

        .vs {
            font-size: 1.4rem;
            font-weight: 700;
            color: #a0aec0;
            margin: 0 15px;
        }

        .betting-info {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .betting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #f1f5f9;
            transition: all 0.2s ease;
        }

        .betting-row:last-child {
            margin-bottom: 0;
        }

        .betting-label {
            font-size: 1rem;
            color: #4a5568;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .betting-value {
            font-weight: 800;
            color: #1a202c;
            font-size: 1.1rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .spread-large {
            color: #38a169;
        }

        .spread-close {
            color: #e53e3e;
        }

            border: 1px solid #e2e8f0;
        }




        .eliminator-rec {
            background: linear-gradient(135deg, #f0fff4 0%, #f7fafc 100%);
            border: 2px solid #c6f6d5;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .rec-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e6fffa;
        }

        .rec-team {
            font-weight: 800;
            font-size: 1.2rem;
            color: #047857;
            background: linear-gradient(135deg, #059669, #047857);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .confidence-badge {
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease;
        }

        .confidence-high {
            background: linear-gradient(135deg, #10b981, #047857);
            color: white;
        }

        .confidence-medium {
            background: linear-gradient(135deg, #f59e0b, #b45309);
            color: white;
        }

        .confidence-low {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
        }

        .confidence-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .safety-score {
            background: linear-gradient(135deg, #1f2937, #374151);
            color: #ffffff;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            border: 2px solid #9ca3af;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            transition: all 0.2s ease;
            cursor: help;
        }

        .safety-score:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .rec-reasons {
            font-size: 0.9rem;
            color: #4a5568;
        }

        .rec-reasons ul {
            margin: 5px 0;
            padding-left: 20px;
        }

        .rec-warnings {
            color: #e53e3e;
            font-size: 0.85rem;
            font-style: italic;
        }

            padding: 8px 12px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .injury-indicator {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 16px;
            height: 16px;
            background: #e53e3e;
            border-radius: 50%;
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: bold;
        }

        .injury-warning {
            background: #fed7d7;
            color: #c53030;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            margin: 5px 0;
        }

        .injury-details {
            font-size: 0.8rem;
            color: #4a5568;
            margin-top: 5px;
        }

        .injury-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-right: 5px;
        }

        .injury-out {
            background: #e53e3e;
            color: white;
        }

        .injury-doubtful {
            background: #ed8936;
            color: white;
        }

        .injury-questionable {
            background: #f6e05e;
            color: #744210;
        }

        .injury-probable {
            background: #48bb78;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4a5568;
        }

        .modal-close:hover {
            color: #4a5568;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4a5568;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .picks-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
        }

        .picks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .pick-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pick-info {
            flex: 1;
        }

        .pick-user {
            font-weight: bold;
            color: #2d3748;
        }

        .pick-team {
            color: #667eea;
            font-size: 1.1rem;
            font-weight: bold;
            margin: 2px 0;
        }

        .pick-reasoning {
            font-size: 0.9rem;
            color: #4a5568;
        }

        .pick-actions {
            display: flex;
            gap: 8px;
        }

        .pick-actions button {
            padding: 5px 10px;
            font-size: 0.8rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #4a5568;
        }

        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #4a5568;
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .filters {
                justify-content: center;
            }

            .games-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .game-card {
                padding: 15px;
            }

            .matchup {
                flex-direction: column;
                gap: 10px;
            }

            .team {
                width: 100%;
                flex-direction: row;
                justify-content: space-between;
            }

            .vs {
                margin: 10px 0;
                align-self: center;
            }

            .modal-content {
                margin: 10% 10px;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .filters {
                flex-direction: column;
            }

            .filter-btn {
                text-align: center;
            }

            .betting-info {
                font-size: 0.85rem;
            }

            .pick-card {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .pick-actions {
                justify-content: center;
            }
        }

        /* Enhanced Modal and Analytics Styles */
        .modal-team-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 10px;
            border: 2px solid #e2e8f0;
            vertical-align: middle;
        }

        .analytics-section {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .team-analytics {
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .team-analytics h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .matchup-advantages {
            background: #fff7ed;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid #fed7aa;
        }

        .matchup-advantages ul {
            margin-top: 5px;
            margin-left: 15px;
        }

        .matchup-advantages li {
            color: #ea580c;
            font-weight: 500;
        }

        .injury-section {
            background: #fef2f2;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #ef4444;
        }

        .injury-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .team-injuries {
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .team-injuries h4 {
            color: #dc2626;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .team-injuries ul {
            margin-left: 15px;
        }

        .team-injuries li {
            font-size: 0.9rem;
            color: #7f1d1d;
            margin-bottom: 3px;
        }

        .injury-impact {
            margin-top: 10px;
            text-align: center;
        }

        .impact-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .impact-high {
            background: #fee2e2;
            color: #dc2626;
        }

        .impact-medium {
            background: #fef3c7;
            color: #d97706;
        }

        .impact-low {
            background: #d1fae5;
            color: #059669;
        }

        .news-section {
            background: #f9fafb;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #6b7280;
        }

        .news-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .news-item:last-child {
            margin-bottom: 0;
        }

        .news-headline {
            font-weight: bold;
            color: #374151;
            margin-bottom: 5px;
        }

        .news-description {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .news-source {
            font-size: 0.8rem;
            color: #9ca3af;
            font-style: italic;
        }

        /* Probability Display Styles */
        .win-probability {
            font-size: 0.9rem;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 12px;
            margin-top: 5px;
            text-align: center;
            color: #1a202c;
            border: 2px solid rgba(255,255,255,0.9);
            min-width: 50px;
        }










        /* Enhanced Confidence Badges */
        .confidence-very_high {
            background: linear-gradient(135deg, #047857, #065f46);
            color: white;
            animation: pulse-very-high 2s infinite;
            box-shadow: 0 2px 4px rgba(4, 120, 87, 0.3);
        }

        .confidence-high {
            background: linear-gradient(135deg, #1e40af, #1e3a8a);
            color: white;
            box-shadow: 0 2px 4px rgba(30, 64, 175, 0.3);
        }

        .confidence-medium {
            background: linear-gradient(135deg, #b45309, #92400e);
            color: white;
            box-shadow: 0 2px 4px rgba(180, 83, 9, 0.3);
        }

        .confidence-low {
            background: linear-gradient(135deg, #b91c1c, #991b1b);
            color: white;
            box-shadow: 0 2px 4px rgba(185, 28, 28, 0.3);
        }

        @keyframes pulse-very-high {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            50% { 
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
        }

        /* Probability Heat Map Colors */
        .game-card[data-confidence="very_high"] {
            border-left: 6px solid #047857;
            background: linear-gradient(135deg, rgba(4, 120, 87, 0.08), rgba(4, 120, 87, 0.03));
            box-shadow: 0 2px 8px rgba(4, 120, 87, 0.1);
        }

        .game-card[data-confidence="high"] {
            border-left: 6px solid #1e40af;
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.08), rgba(30, 64, 175, 0.03));
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.1);
        }

        .game-card[data-confidence="medium"] {
            border-left: 6px solid #b45309;
            background: linear-gradient(135deg, rgba(180, 83, 9, 0.08), rgba(180, 83, 9, 0.03));
            box-shadow: 0 2px 8px rgba(180, 83, 9, 0.1);
        }

        .game-card[data-confidence="low"] {
            border-left: 6px solid #b91c1c;
            background: linear-gradient(135deg, rgba(185, 28, 28, 0.08), rgba(185, 28, 28, 0.03));
            box-shadow: 0 2px 8px rgba(185, 28, 28, 0.1);
        }

        /* History Tab Styles */
        .history-section {
            max-width: 1200px;
            margin: 0 auto;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .week-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .history-timeline {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .performance-summary {
            margin-top: 30px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .summary-card h3 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        /* Strategy Tab Styles */
        .strategy-section {
            max-width: 1200px;
            margin: 0 auto;
        }

        .strategy-header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .strategy-header h2 {
            color: #1a202c;
            margin-bottom: 10px;
        }

        .strategy-header p {
            color: #6b7280;
            font-size: 1.1rem;
        }

        .strategy-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .strategy-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .strategy-card h3 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        /* Settings Tab Styles */
        .settings-section {
            max-width: 800px;
            margin: 0 auto;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .settings-header h2 {
            color: #1a202c;
            margin-bottom: 10px;
        }

        .settings-header p {
            color: #6b7280;
            font-size: 1.1rem;
        }

        .settings-groups {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .settings-group {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .settings-group h3 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 1.2rem;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .family-settings {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .family-member input {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 1rem;
        }

        .notification-settings label,
        .appearance-settings label,
        .refresh-settings label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 1rem;
            color: #4a5568;
        }

        .notification-settings input[type="checkbox"],
        .appearance-settings input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .refresh-settings select {
            padding: 8px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            margin-left: 10px;
        }

        .settings-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        /* History Timeline Styles */
        .history-week-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .history-week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .history-week-header h3 {
            color: #1a202c;
            font-size: 1.3rem;
            margin: 0;
        }

        .week-summary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .history-picks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .history-pick {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .history-pick.win {
            border-color: #10b981;
            background: #ecfdf5;
        }

        .history-pick.loss {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .history-pick.no-pick {
            border-color: #9ca3af;
            background: #f3f4f6;
            opacity: 0.6;
        }

        .person-name {
            font-weight: 600;
            color: #374151;
            margin-bottom: 10px;
        }

        .pick-team {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .pick-logo {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .pick-result {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .pick-result.win {
            color: #10b981;
        }

        .pick-result.loss {
            color: #ef4444;
        }

        .pick-result.pending {
            color: #6b7280;
        }

        /* Strategy Game Cards */
        .strategy-game-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
        }

        .game-matchup {
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 8px;
        }

        .pick-recommendation,
        .safety-score,
        .value-score {
            font-size: 0.9rem;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            .tab-navigation {
                flex-wrap: wrap;
                gap: 4px;
            }

            .tab-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .strategy-cards {
                grid-template-columns: 1fr;
            }

            .analytics-grid,
            .injuries-grid,
            .betting-grid {
                grid-template-columns: 1fr;
            }
            .analytics-card,
            .injury-card,
            .betting-card {
                padding: 15px;
            }

            .modal-team-logo {
                width: 30px;
                height: 30px;
                margin: 0 5px;
            }


            .win-probability {
                font-size: 0.8rem;
                padding: 3px 6px;
                min-width: 40px;
            }

            .game-card {
                padding: 20px;
            }

            .matchup {
                padding: 12px 0;
            }

            .betting-info {
                padding: 12px;
            }
        }

        /* Top Pick Confidence Section */
        .top-pick-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            margin: 20px 0;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .top-pick-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse-bg 3s ease-in-out infinite;
        }

        @keyframes pulse-bg {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .top-pick-header {
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        .section-header {
            color: #1a202c;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 16px;
            text-align: left;
        }
        .top-picks-horizontal {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            width: 100%;
        }
        .top-pick-card {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .top-pick-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 0.25);
        }
        .top-pick-logo {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            margin-right: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .top-pick-info {
            flex: 1;
        }
        .top-pick-team {
            font-weight: 700;
            font-size: 1rem;
            color: white;
            margin-bottom: 4px;
        }
        .top-pick-confidence {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
        }
        .top-pick-details {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 2px;
        }
        .game-insights {
            margin-top: 12px;
            padding: 8px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 3px solid #e2e8f0;
        }

        .click-details {
            text-align: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }

        .click-details span {
            color: #667eea;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .click-details span:hover {
            color: #4c51bf;
            text-decoration: underline;
        }


        /* Advanced Analytics Tab Styling */
        .trending-teams-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 10px;
        }

        .trending-section h4 {
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #1a202c;
        }

        .team-trend-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .team-trend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            background: white;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .team-trend-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .team-trend-item.hot {
            border-left: 4px solid #059669;
        }

        .team-trend-item.cold {
            border-left: 4px solid #dc2626;
        }

        .team-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .trend-logo {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .team-details {
            display: flex;
            flex-direction: column;
        }

        .team-name {
            font-weight: 700;
            font-size: 0.9rem;
        }

        .team-record {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .trend-stats {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .trend-arrow {
            font-size: 1.2rem;
        }

        .trend-value {
            font-weight: 700;
            font-size: 0.9rem;
        }

        /* Recent Form Styling */
        .recent-form-analysis {
            margin-top: 10px;
        }

        .form-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .form-filter-btn {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #4a5568;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .form-filter-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
        }

        .form-team-card {
            background: white;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .form-team-card.hot {
            border-left: 4px solid #059669;
        }

        .form-team-card.cold {
            border-left: 4px solid #dc2626;
        }

        .form-team-card.neutral {
            border-left: 4px solid #f59e0b;
        }

        .form-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .form-logo {
            width: 28px;
            height: 28px;
            border-radius: 50%;
        }

        .form-team-name {
            font-weight: 700;
            font-size: 0.9rem;
        }

        .form-games {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
        }

        .form-game {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .form-game.W {
            background: #d1fae5;
        }

        .form-game.L {
            background: #fee2e2;
        }

        .form-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-stat {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .stat-value {
            font-weight: 700;
            font-size: 0.85rem;
        }

        /* Home/Away Splits Styling */
        .splits-analysis {
            margin-top: 10px;
        }

        .splits-summary {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .split-stat {
            text-align: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .splits-chart-container {
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .splits-teams {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .splits-section h5 {
            margin-bottom: 10px;
            color: #1a202c;
        }

        .splits-team-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .splits-team-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .splits-logo {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .splits-team-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .splits-advantage {
            font-weight: 700;
            color: #059669;
            font-size: 0.85rem;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .trending-teams-grid,
            .splits-teams {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .splits-summary {
                justify-content: center;
            }
        }

        /* Injury & News Tab Styling */
        .injury-analysis {
            margin-top: 10px;
        }

        .injury-summary-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .injury-stat {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            min-width: 80px;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: #dc2626;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 4px;
        }

        .injury-categories {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .injury-category h4 {
            margin-bottom: 10px;
            font-size: 1rem;
            color: #1a202c;
        }

        .injury-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .injury-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .injury-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .injury-item.critical {
            border-left: 4px solid #dc2626;
        }

        .injury-item.moderate {
            border-left: 4px solid #f59e0b;
        }

        .injury-player {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .injury-team-logo {
            width: 28px;
            height: 28px;
            border-radius: 50%;
        }

        .player-info {
            display: flex;
            flex-direction: column;
        }

        .player-name {
            font-weight: 700;
            font-size: 0.9rem;
        }

        .player-position {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .injury-details {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }

        .injury-status {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .injury-status.out {
            background: #fee2e2;
            color: #dc2626;
        }

        .injury-status.doubtful {
            background: #fef3c7;
            color: #d97706;
        }

        .injury-status.questionable {
            background: #fde68a;
            color: #92400e;
        }

        .injury-status.probable {
            background: #d1fae5;
            color: #059669;
        }

        .injury-impact {
            font-size: 0.75rem;
            color: #6b7280;
        }

        /* News Feed Styling */
        .news-feed {
            margin-top: 10px;
        }

        .news-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .news-filter-btn {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #4a5568;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .news-filter-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .news-timeline {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 15px;
        }

        .news-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .news-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .news-item.critical {
            border-left: 4px solid #dc2626;
        }

        .news-item.important {
            border-left: 4px solid #f59e0b;
        }

        .news-item.normal {
            border-left: 4px solid #3b82f6;
        }

        .news-time {
            color: #6b7280;
            font-size: 0.75rem;
            min-width: 50px;
            font-weight: 500;
        }

        .news-content {
            flex: 1;
        }

        .news-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .news-team-logo {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .news-priority {
            font-size: 1rem;
        }

        .news-headline {
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .news-summary {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 6px;
        }

        .news-tags {
            display: flex;
            gap: 6px;
        }

        .news-tag {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .news-tag.injuries {
            background: #fee2e2;
            color: #dc2626;
        }

        .news-tag.trades {
            background: #e0e7ff;
            color: #3730a3;
        }

        .news-tag.lineup {
            background: #ecfccb;
            color: #365314;
        }

        .news-tag.team {
            background: #f3f4f6;
            color: #374151;
        }

        .news-live-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: center;
            padding: 8px;
            background: #f8fafc;
            border-radius: 6px;
            font-size: 0.8rem;
            color: #6b7280;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .insight-item {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .insight-item:last-child {
            margin-bottom: 0;
        }
        .insight-icon {
            width: 12px;
            height: 12px;
            display: inline-block;
        }
        .insight-injury {
            color: #dc2626;
            border-left-color: #dc2626;
        }
        .insight-weather {
            color: #0369a1;
            border-left-color: #0369a1;
        }
        .insight-line {
            color: #059669;
            border-left-color: #059669;
        }

        /* Advanced Analytics Tab Styles */
        .analytics-section {
            max-width: 1400px;
            margin: 0 auto;
        }
        .analytics-header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .analytics-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }
        .analytics-card h3 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .chart-container {
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Injury & News Tab Styles */
        .injuries-section {
            max-width: 1400px;
            margin: 0 auto;
        }
        .injuries-header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .injuries-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .injury-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }
        .injury-card h3 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Betting Intelligence Tab Styles */
        .betting-section {
            max-width: 1400px;
            margin: 0 auto;
        }
        .betting-header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .betting-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .betting-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }
        .betting-card h3 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Pool Strategy Enhanced Styles */
        .remaining-teams-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            margin-bottom: 30px;
        }
        .remaining-teams-section h3 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        .matrix-container {
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pick-history-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            margin-bottom: 30px;
        }
        .pick-history-section h3 {
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        .history-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Loading Skeleton Styles */
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            font-size: 0.9rem;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .top-pick-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .top-pick-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            padding: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .top-pick-info {
            text-align: left;
        }

        .top-pick-team {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .top-pick-confidence {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .top-pick-details {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .top-pick-content {
                flex-direction: column;
                gap: 15px;
            }
            .top-pick-info {
                text-align: center;
            }
            .top-pick-logo {
                width: 50px;
                height: 50px;
            }
            .top-picks-horizontal {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            .top-pick-card {
                padding: 12px;
            }
            .section-header {
                font-size: 1.1rem;
                margin-bottom: 12px;
            }
            .game-insights {
                margin-top: 8px;
                padding: 6px;
            }
            .insight-item {
                font-size: 0.7rem;
                margin-bottom: 2px;
            }
            .game-header {
                padding: 10px 14px;
                margin: -16px -16px 14px -16px;
                margin-bottom: 14px;
            }
            .game-time {
                font-size: 0.9rem;
            }
        }
        @media (max-width: 480px) {
            .top-picks-horizontal {
                gap: 8px;
            }
            .top-pick-card {
                padding: 10px;
            }
            .top-pick-team {
                font-size: 0.9rem;
            }
            .top-pick-confidence {
                font-size: 0.8rem;
            }
            .top-pick-details {
                font-size: 0.75rem;
            }
            .game-time {
                font-size: 0.8rem;
                line-height: 1.2;
            }
            .game-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
                padding: 8px 12px;
            }
            .game-status {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1> NFL Week <span id="current-week">3</span> Dashboard</h1>
            <p>Your complete eliminator pool companion</p>
            <div class="last-updated">
                <span id="last-updated-time">Last updated: Loading...</span>
                <button id="force-refresh-btn" class="btn-small"> Refresh Data</button>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-navigation">
            <button class="tab-btn active" data-tab="games-picks"> Games & Picks</button>
            <button class="tab-btn" data-tab="analytics"> Advanced Analytics</button>
            <button class="tab-btn" data-tab="injuries-news"> Injury & News</button>
            <button class="tab-btn" data-tab="betting"> Betting Intelligence</button>
            <button class="tab-btn" data-tab="strategy"> Pool Strategy</button>
        </nav>

        <!-- Top Pick Confidence Section -->
        <div id="top-pick-section" class="top-pick-section" style="display: none;">
            <div class="top-pick-header"> This Week's Top 3 Picks</div>
            <div class="top-picks-horizontal" id="top-picks-container">
                <!-- Top 3 picks will be dynamically populated here -->
            </div>
        </div>

        <!-- Games & Picks Tab Content -->
        <div class="tab-content active" id="games-picks-tab">
            <div class="controls">
            <h3 class="section-header"> Game Filters</h3>
            <div class="filters">
                <button class="filter-btn active" data-filter="all">All Games</button>
                <button class="filter-btn" data-filter="large-spreads">Large Spreads (7+)</button>
                <button class="filter-btn" data-filter="close-games">Close Games (<3)</button>
                <button class="filter-btn" data-filter="weather-impact">Weather Impact</button>
                <button class="filter-btn" data-filter="high-safety" title="Games with safety scores 80+"> High Safety</button>
                <button class="filter-btn" data-filter="high-confidence" title="High confidence eliminator picks"> High Confidence</button>
                <button class="filter-btn" data-filter="injury-impact" title="Games with significant injury concerns"> Injury Impact</button>
                <button class="filter-btn" data-filter="home-favorites" title="Home teams favored by 3+ points"> Home Favorites</button>
                <button class="filter-btn" data-filter="upset-alert" title="Games with high upset potential"> Upset Alert</button>
                <button class="filter-btn" data-filter="value-plays" title="Best risk/reward ratio games"> Value Plays</button>
                <button class="filter-btn" data-filter="prime-time" title="Sunday/Monday Night Football"> Prime Time</button>
                <button class="filter-btn" data-filter="divisional" title="Division rival matchups"> Divisional</button>
            </div>

            <div class="actions">
                <button class="btn btn-secondary" id="refresh-btn"> Refresh</button>
                <button class="btn btn-primary" id="add-pick-btn"> Add Pick</button>
            </div>
        </div>

        <div class="picks-summary">
            <div class="picks-count" id="picks-count">0/5 picks made this week</div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Loading games...</p>
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="games-container" class="games-grid"></div>

            <div class="picks-section">
                <div class="picks-header">
                    <h2>Your Picks This Week</h2>
                    <button class="btn btn-secondary" id="clear-picks-btn">Clear All</button>
                </div>
                <div id="picks-container">
                    <div class="empty-state">
                        <h3>No picks yet</h3>
                        <p>Add your eliminator pool picks to track them here</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Analytics Tab Content -->
        <div class="tab-content" id="analytics-tab">
            <div class="analytics-section">
                <div class="analytics-header">
                    <h2> Advanced Analytics</h2>
                    <p>Team performance, trends, and historical data analysis</p>
                </div>

                <!-- Team Performance Dashboard -->
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3> Team Performance</h3>
                        <div id="team-performance-chart" class="chart-container">
                            <div class="loading-skeleton">Loading team performance data...</div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3> Trending Teams</h3>
                        <div id="trending-teams" class="trending-container">
                            <div class="loading-skeleton">Loading trending data...</div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3> Recent Form</h3>
                        <div id="recent-form" class="form-container">
                            <div class="loading-skeleton">Loading form analysis...</div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3> Home vs Away</h3>
                        <div id="home-away-splits" class="splits-container">
                            <div class="loading-skeleton">Loading home/away splits...</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Injury & News Tab Content -->
        <div class="tab-content" id="injuries-news-tab">
            <div class="injuries-section">
                <div class="injuries-header">
                    <h2> Injury & News</h2>
                    <p>Real-time injury reports and breaking NFL news</p>
                </div>

                <!-- Injury Monitor -->
                <div class="injuries-grid">
                    <div class="injury-card">
                        <h3> Critical Injuries</h3>
                        <div id="critical-injuries" class="injury-list">
                            <div class="loading-skeleton">Loading critical injury data...</div>
                        </div>
                    </div>

                    <div class="injury-card">
                        <h3> Breaking News</h3>
                        <div id="breaking-news" class="news-feed">
                            <div class="loading-skeleton">Loading latest news...</div>
                        </div>
                    </div>

                    <div class="injury-card">
                        <h3> Player Status</h3>
                        <div id="player-status" class="status-tracker">
                            <div class="loading-skeleton">Loading player status updates...</div>
                        </div>
                    </div>

                    <div class="injury-card">
                        <h3> Impact Analysis</h3>
                        <div id="impact-analysis" class="impact-container">
                            <div class="loading-skeleton">Loading impact analysis...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Betting Intelligence Tab Content -->
        <div class="tab-content" id="betting-tab">
            <div class="betting-section">
                <div class="betting-header">
                    <h2> Betting Intelligence</h2>
                    <p>Line movements, public betting data, and sharp money alerts</p>
                </div>

                <!-- Betting Intelligence Grid -->
                <div class="betting-grid">
                    <div class="betting-card">
                        <h3> Line Movement</h3>
                        <div id="line-movement-chart" class="chart-container">
                            <div class="loading-skeleton">Loading line movement data...</div>
                        </div>
                    </div>

                    <div class="betting-card">
                        <h3> Public vs Sharp</h3>
                        <div id="public-sharp-data" class="betting-splits">
                            <div class="loading-skeleton">Loading betting splits...</div>
                        </div>
                    </div>

                    <div class="betting-card">
                        <h3> Value Opportunities</h3>
                        <div id="value-bets" class="value-container">
                            <div class="loading-skeleton">Loading value opportunities...</div>
                        </div>
                    </div>

                    <div class="betting-card">
                        <h3> Sharp Alerts</h3>
                        <div id="sharp-alerts" class="alerts-container">
                            <div class="loading-skeleton">Loading sharp money alerts...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategy Tab Content -->
        <div class="tab-content" id="strategy-tab">
            <div class="strategy-section">
                <div class="strategy-header">
                    <h2> Pool Strategy</h2>
                    <p>Eliminator pool optimization, remaining teams, and strategic planning</p>
                </div>

                <!-- Remaining Teams Matrix -->
                <div class="remaining-teams-section">
                    <h3> Remaining Teams Matrix</h3>
                    <div id="remaining-teams-matrix" class="matrix-container">
                        <div class="loading-skeleton">Loading remaining teams matrix...</div>
                    </div>
                </div>

                <!-- Pick History Timeline -->
                <div class="pick-history-section">
                    <h3> Pick History & Performance</h3>
                    <div class="history-controls">
                        <button class="filter-btn active" data-filter="all-weeks">All Weeks</button>
                        <button class="filter-btn" data-filter="recent">Recent (Last 4)</button>
                        <button class="filter-btn" data-filter="wins-only">Wins Only</button>
                        <button class="filter-btn" data-filter="losses-only">Losses Only</button>
                        <button class="btn btn-primary" id="add-historical-week-btn">+ Add Week</button>
                    </div>
                    <div id="history-timeline" class="history-timeline">
                        <div class="empty-state">
                            <h3>No historical data yet</h3>
                            <p>Add previous weeks' picks to track performance over time</p>
                        </div>
                    </div>
                </div>

                <!-- Strategy Cards -->
                <div class="strategy-cards">
                    <div class="strategy-card">
                        <h3> High-Confidence Picks</h3>
                        <div id="high-confidence-games"></div>
                    </div>
                    <div class="strategy-card">
                        <h3> Value Plays</h3>
                        <div id="value-plays-games"></div>
                    </div>
                    <div class="strategy-card">
                        <h3> Risk Assessment</h3>
                        <div id="risk-assessment"></div>
                    </div>
                    <div class="strategy-card">
                        <h3> Season Planning</h3>
                        <div id="season-planning"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab Content -->
        <div class="tab-content" id="settings-tab">
            <div class="settings-section">
                <div class="settings-header">
                    <h2> Settings & Preferences</h2>
                    <p>Customize your NFL dashboard experience</p>
                </div>

                <div class="settings-groups">
                    <div class="settings-group">
                        <h3> Family Members</h3>
                        <div class="family-settings">
                            <div class="family-member">
                                <input type="text" placeholder="Person 1 Name" class="person-name" data-person="1">
                            </div>
                            <div class="family-member">
                                <input type="text" placeholder="Person 2 Name" class="person-name" data-person="2">
                            </div>
                            <div class="family-member">
                                <input type="text" placeholder="Person 3 Name" class="person-name" data-person="3">
                            </div>
                            <div class="family-member">
                                <input type="text" placeholder="Person 4 Name" class="person-name" data-person="4">
                            </div>
                            <div class="family-member">
                                <input type="text" placeholder="Person 5 Name" class="person-name" data-person="5">
                            </div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3> Notifications</h3>
                        <div class="notification-settings">
                            <label><input type="checkbox" id="line-movement-alerts" checked> Line Movement Alerts (3+ points)</label>
                            <label><input type="checkbox" id="injury-alerts" checked> Key Injury Updates</label>
                            <label><input type="checkbox" id="game-start-alerts"> Game Start Reminders</label>
                            <label><input type="checkbox" id="morning-brief" checked> Daily Morning Brief (6 AM)</label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3> Appearance</h3>
                        <div class="appearance-settings">
                            <label><input type="checkbox" id="dark-mode"> Dark Mode</label>
                            <label><input type="checkbox" id="simplified-mode"> Simplified Mode (Less Data)</label>
                            <label><input type="checkbox" id="large-logos" checked> Large Team Logos</label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3> Data Refresh</h3>
                        <div class="refresh-settings">
                            <label>Morning Update Time:
                                <select id="refresh-time">
                                    <option value="5">5:00 AM</option>
                                    <option value="6" selected>6:00 AM</option>
                                    <option value="7">7:00 AM</option>
                                    <option value="8">8:00 AM</option>
                                </select>
                            </label>
                            <button class="btn btn-secondary" id="test-refresh">Test Refresh Now</button>
                        </div>
                    </div>
                </div>

                <div class="settings-actions">
                    <button class="btn btn-primary" id="save-settings">Save Settings</button>
                    <button class="btn btn-secondary" id="reset-settings">Reset to Defaults</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Details Modal -->
    <div id="game-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div id="game-details"></div>
        </div>
    </div>

    <!-- Add Pick Modal -->
    <div id="pick-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>Add Eliminator Pick</h2>
            <form id="pick-form">
                <div class="form-group">
                    <label for="pick-user">Your Name</label>
                    <input type="text" id="pick-user" required maxlength="30">
                </div>
                <div class="form-group">
                    <label for="pick-team">Selected Team</label>
                    <select id="pick-team" required>
                        <option value="">Choose a team...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pick-confidence">Confidence Level</label>
                    <select id="pick-confidence" required>
                        <option value="">Select confidence...</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pick-reasoning">Reasoning (optional)</label>
                    <textarea id="pick-reasoning" placeholder="Why this pick?" maxlength="140"></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary modal-close">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Pick</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        class NFLGameTracker {
            constructor() {
                this.currentWeek = 3; // Default to Week 3 as requested
                this.currentFilter = 'all';
                this.currentTab = 'games-picks';
                this.games = [];
                this.picks = this.loadPicks();
                this.historicalPicks = this.loadHistoricalPicks();
                this.settings = this.loadSettings();

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupTabNavigation();
                this.detectCurrentWeek();
                this.loadGames();
                this.renderPicks();
                this.updateLastRefreshTime();
            }

            setupEventListeners() {
                // Force refresh button
                document.getElementById('force-refresh-btn').addEventListener('click', () => {
                    this.forceRefresh();
                });

                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentFilter = e.target.dataset.filter;
                        this.renderGames();
                    });
                });

                // Action buttons
                document.getElementById('refresh-btn').addEventListener('click', () => this.loadGames());
                document.getElementById('add-pick-btn').addEventListener('click', () => this.showAddPickModal());
                document.getElementById('clear-picks-btn').addEventListener('click', () => this.clearAllPicks());

                // Modal handling
                document.querySelectorAll('.modal-close').forEach(btn => {
                    btn.addEventListener('click', () => this.closeModals());
                });

                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) this.closeModals();
                    });
                });

                // Pick form
                document.getElementById('pick-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addPick();
                });
            }

            setupTabNavigation() {
                // Tab navigation
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                    });
                });
            }

            switchTab(tabName) {
                // Remove active class from all tabs and content
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                // Add active class to selected tab and content
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');

                this.currentTab = tabName;

                // Load tab-specific content
                this.loadTabContent(tabName);
            }

            loadTabContent(tabName) {
                switch(tabName) {
                    case 'games-picks':
                        // Games & Picks tab content is already loaded
                        break;
                    case 'analytics':
                        this.loadAnalyticsTab();
                        break;
                    case 'injuries-news':
                        this.loadInjuriesNewsTab();
                        break;
                    case 'betting':
                        this.loadBettingTab();
                        break;
                    case 'strategy':
                        this.loadStrategyTab();
                        break;
                    case 'settings':
                        this.loadSettingsTab();
                        break;
                    default:
                        break;
                }
            }

            forceRefresh() {
                document.getElementById('force-refresh-btn').textContent = ' Refreshing...';
                this.loadGames().finally(() => {
                    document.getElementById('force-refresh-btn').textContent = ' Refresh Data';
                    this.updateLastRefreshTime();
                });
            }

            updateLastRefreshTime() {
                const now = new Date();
                const timeString = now.toLocaleString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
                document.getElementById('last-updated-time').textContent = `Last updated: ${timeString}`;
                document.getElementById('current-week').textContent = this.currentWeek;
            }

            async detectCurrentWeek() {
                try {
                    const response = await fetch('/api/current-week');
                    if (response.ok) {
                        const data = await response.json();
                        this.currentWeek = data.week;
                        this.currentSeason = data.season;
                        document.getElementById('week-select').value = data.week;
                        console.log(`Detected current week: ${data.week} of ${data.season} season`);
                    } else {
                        // Fallback to client-side detection
                        this.fallbackWeekDetection();
                    }
                } catch (error) {
                    console.error('Error detecting current week:', error);
                    this.fallbackWeekDetection();
                }
            }

            fallbackWeekDetection() {
                // Simple week detection based on date
                const now = new Date();
                const currentYear = now.getFullYear();
                const seasonStart = new Date(currentYear, 8, 5); // September 5th
                
                // Adjust for actual season start (first Thursday of September)
                while (seasonStart.getDay() !== 4) { // Thursday is day 4
                    seasonStart.setDate(seasonStart.getDate() + 1);
                }
                
                if (now < seasonStart) {
                    this.currentWeek = 1;
                } else {
                    const weeksSinceStart = Math.floor((now - seasonStart) / (7 * 24 * 60 * 60 * 1000)) + 1;
                    this.currentWeek = Math.min(Math.max(weeksSinceStart, 1), 18);
                }
                
                document.getElementById('week-select').value = this.currentWeek;
                console.log(`Fallback week detection: Week ${this.currentWeek}`);
            }

            // Helper function to properly format team records
            getTeamRecord(team) {
                if (!team || !team.record) {
                    return '0-0';
                }
                
                // If record is already a string, return it
                if (typeof team.record === 'string') {
                    return team.record;
                }
                
                // If record is an object with wins/losses, format it
                if (team.record.wins !== undefined && team.record.losses !== undefined) {
                    return `${team.record.wins}-${team.record.losses}`;
                }
                
                // Fallback for any other format
                return '0-0';
            }

            // Helper function for accessible probability colors
            getProbabilityColor(probability) {
                if (probability >= 75) return '#047857'; // Dark green for very high
                if (probability >= 65) return '#1e40af'; // Dark blue for high
                if (probability >= 55) return '#b45309'; // Dark orange for medium
                return '#b91c1c'; // Dark red for low
            }

            getProbabilityBackgroundColor(probability) {
                if (probability >= 75) return '#d1fae5'; // Light green background
                if (probability >= 65) return '#dbeafe'; // Light blue background
                if (probability >= 55) return '#fef3c7'; // Light orange background
                return '#fee2e2'; // Light red background
            }

            async loadGames() {
                const cacheKey = `nfl_week_${this.currentWeek}_2025_games`;
                const cacheTimeKey = `${cacheKey}_timestamp`;
                const cacheExpiryMinutes = 15; // Browser cache for 15 minutes

                console.log(` Loading games for Week ${this.currentWeek}...`);

                // Step 1: Try to load from browser cache first
                const cachedGames = this.loadFromBrowserCache(cacheKey, cacheTimeKey, cacheExpiryMinutes);
                if (cachedGames) {
                    console.log(' Using browser cache - instant loading!');
                    this.games = cachedGames;
                    this.sortGamesByConfidence();
                    this.updateTopPick();
                    this.renderGames();
                    this.populateTeamSelect();

                    // Background refresh check (don't show loading)
                    this.backgroundRefreshCheck(cacheKey, cacheTimeKey);
                    return;
                }

                // Step 2: No cache available, show loading and fetch
                console.log(' No browser cache, fetching from server...');
                this.showLoading(true);
                this.hideError();

                try {
                    const response = await fetch(`/api/games/${this.currentWeek}`);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    this.games = await response.json();

                    // Cache the fresh data in browser
                    this.saveToBrowserCache(cacheKey, cacheTimeKey, this.games);

                    // Sort games by confidence score (highest to lowest)
                    this.sortGamesByConfidence();
                    this.updateTopPick();
                    this.renderGames();
                    this.populateTeamSelect();

                    console.log(` Fetched and cached ${this.games.length} games`);

                } catch (error) {
                    console.error('Error loading games:', error);
                    this.showError('Failed to load games. Please check your connection and try again.');
                } finally {
                    this.showLoading(false);
                }
            }

            loadFromBrowserCache(cacheKey, cacheTimeKey, expiryMinutes) {
                try {
                    const cachedData = localStorage.getItem(cacheKey);
                    const cachedTime = localStorage.getItem(cacheTimeKey);

                    if (!cachedData || !cachedTime) return null;

                    const cacheAge = (Date.now() - parseInt(cachedTime)) / (1000 * 60); // minutes

                    if (cacheAge > expiryMinutes) {
                        console.log(` Browser cache expired (${Math.round(cacheAge)} minutes old)`);
                        // Clean up expired cache
                        localStorage.removeItem(cacheKey);
                        localStorage.removeItem(cacheTimeKey);
                        return null;
                    }

                    console.log(` Found browser cache (${Math.round(cacheAge)} minutes old)`);
                    return JSON.parse(cachedData);
                } catch (error) {
                    console.error('Error loading from browser cache:', error);
                    return null;
                }
            }

            saveToBrowserCache(cacheKey, cacheTimeKey, data) {
                try {
                    localStorage.setItem(cacheKey, JSON.stringify(data));
                    localStorage.setItem(cacheTimeKey, Date.now().toString());
                    console.log(' Saved to browser cache');
                } catch (error) {
                    console.error('Error saving to browser cache:', error);
                }
            }

            async backgroundRefreshCheck(cacheKey, cacheTimeKey) {
                // Background check for updates without showing loading
                try {
                    console.log(' Background refresh check...');
                    const response = await fetch(`/api/games/${this.currentWeek}`);

                    if (response.ok) {
                        const freshGames = await response.json();

                        // Simple comparison - if game count different, update
                        if (freshGames.length !== this.games.length) {
                            console.log(' Data changed, updating display...');
                            this.games = freshGames;
                            this.saveToBrowserCache(cacheKey, cacheTimeKey, freshGames);
                            this.sortGamesByConfidence();
                            this.updateTopPick();
                            this.renderGames();
                            this.populateTeamSelect();
                        } else {
                            console.log(' No changes detected in background check');
                        }
                    }
                } catch (error) {
                    console.log('Background refresh failed (this is ok):', error.message);
                }
            }

            renderGames() {
                const container = document.getElementById('games-container');
                
                if (this.games.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No games available</h3>
                            <p>Games for Week ${this.currentWeek} are not yet available.</p>
                        </div>
                    `;
                    return;
                }

                const filteredGames = this.filterGames(this.games);
                
                if (filteredGames.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No games match filter</h3>
                            <p>Try selecting a different filter to see games.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredGames.map(game => this.renderGameCard(game)).join('');

                // Add click listeners to game cards
                container.querySelectorAll('.game-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const gameId = card.dataset.gameId;
                        this.showGameDetails(gameId);
                    });
                });
            }

            filterGames(games) {
                switch (this.currentFilter) {
                    case 'large-spreads':
                        return games.filter(game => Math.abs(game.spread) >= 7);
                    case 'close-games':
                        return games.filter(game => Math.abs(game.spread) < 3);
                    case 'weather-impact':
                        return games.filter(game => 
                            !game.weather.indoor && 
                            (game.weather.condition === 'Snow' || 
                             game.weather.condition === 'Rain' || 
                             game.weather.wind > 15)
                        );
                    case 'high-safety':
                        return games.filter(game => 
                            game.eliminator && game.eliminator.safety_score >= 80
                        );
                    case 'high-confidence':
                        return games.filter(game => 
                            game.eliminator && game.eliminator.confidence === 'high'
                        );
                    case 'injury-impact':
                        return games.filter(game => 
                            game.injuries && (
                                (game.injuries.impact_score && game.injuries.impact_score > 6) ||
                                (game.injuries.away_team && game.injuries.away_team.length >= 3) ||
                                (game.injuries.home_team && game.injuries.home_team.length >= 3)
                            )
                        );
                    case 'home-favorites':
                        return games.filter(game => 
                            game.favorite === 'home' && Math.abs(game.spread) >= 3
                        );
                    case 'upset-alert':
                        return games.filter(game => 
                            game.eliminator && (
                                (game.eliminator.risk_factors && game.eliminator.risk_factors.length > 2) ||
                                (game.eliminator.safety_score < 60 && Math.abs(game.spread) < 7)
                            )
                        );
                    case 'value-plays':
                        return games.filter(game => 
                            game.eliminator && game.eliminator.value_score > 75
                        );
                    case 'prime-time':
                        return games.filter(game => {
                            const gameDate = new Date(game.date);
                            const hour = gameDate.getHours();
                            const dayOfWeek = gameDate.getDay();
                            // Sunday (0) or Monday (1) games after 7 PM
                            return (dayOfWeek === 0 || dayOfWeek === 1) && hour >= 19;
                        });
                    case 'divisional':
                        return games.filter(game => 
                            game.divisional === true
                        );
                    default:
                        return games;
                }
            }

            sortGamesByConfidence() {
                if (!this.games || this.games.length === 0) return;

                // Define confidence levels and their numeric values
                const confidenceValues = {
                    'very_high': 100,
                    'high': 80,
                    'medium': 50,
                    'low': 20
                };

                this.games.sort((a, b) => {
                    const aConfidence = a.eliminator?.confidence || 'low';
                    const bConfidence = b.eliminator?.confidence || 'low';
                    const aSafetyScore = a.eliminator?.safety_score || 0;
                    const bSafetyScore = b.eliminator?.safety_score || 0;

                    // Primary sort: confidence level
                    const aValue = confidenceValues[aConfidence] || 0;
                    const bValue = confidenceValues[bConfidence] || 0;

                    if (aValue !== bValue) {
                        return bValue - aValue; // Higher confidence first
                    }

                    // Secondary sort: safety score
                    return bSafetyScore - aSafetyScore;
                });
            }

            updateTopPick() {
                const topPickSection = document.getElementById('top-pick-section');
                const topPicksContainer = document.getElementById('top-picks-container');

                if (!this.games || this.games.length === 0) {
                    topPickSection.style.display = 'none';
                    return;
                }

                // Find top 3 highest confidence games
                const topGames = this.games.filter(game =>
                    game.eliminator && game.eliminator.confidence !== 'low'
                ).slice(0, 3);

                if (topGames.length === 0) {
                    topPickSection.style.display = 'none';
                    return;
                }

                // Show and populate the top picks section
                topPickSection.style.display = 'block';

                // Generate HTML for all top picks
                topPicksContainer.innerHTML = topGames.map((game, index) => {
                    const recommendedTeam = game.eliminator.recommended_team;
                    const isHomeRecommended = recommendedTeam === game.home_team.abbr;
                    const teamData = isHomeRecommended ? game.home_team : game.away_team;
                    const opponent = isHomeRecommended ? game.away_team : game.home_team;
                    const spread = Math.abs(game.spread);
                    const rank = index + 1;

                    return `
                        <div class="top-pick-card">
                            <img class="top-pick-logo" src="${teamData.logo || `https://a.espncdn.com/i/teamlogos/nfl/500/${teamData.abbr.toLowerCase()}.png`}" alt="${teamData.name} logo">
                            <div class="top-pick-info">
                                <div class="top-pick-team">#${rank} ${teamData.name}</div>
                                <div class="top-pick-confidence">${Math.round(game.eliminator.safety_score || 0)}% Confidence</div>
                                <div class="top-pick-details">vs ${opponent.name}  ${spread} pt favorite</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderGameCard(game) {
                const gameTime = new Date(game.date).toLocaleString('en-US', {
                    weekday: 'short',
                    month: 'short', 
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });

                const spreadText = game.spread > 0 ? `+${game.spread}` : game.spread;
                const spreadClass = Math.abs(game.spread) >= 7 ? 'spread-large' : 
                                  Math.abs(game.spread) < 3 ? 'spread-close' : '';
                
                const weatherWarning = !game.weather.indoor && 
                    (game.weather.condition === 'Snow' || game.weather.condition === 'Rain') && 
                    game.weather.wind > 15;

                return `
                    <div class="game-card" data-game-id="${game.id}" data-confidence="${game.eliminator?.confidence || 'low'}">
                        <div class="game-header">
                            <span class="game-time">${gameTime}</span>
                            <span class="game-status status-${game.status}">${game.status}</span>
                        </div>


                        <div class="matchup">
                            <div class="team">
                                <div style="position: relative; display: inline-block;">
                                    <img src="${game.away_team.logo || `https://a.espncdn.com/i/teamlogos/nfl/500/${game.away_team.abbr.toLowerCase()}.png`}" 
                                         alt="${game.away_team.name} logo" 
                                         class="team-logo"
                                         onerror="this.style.display='none'">
                                    ${game.injuries && game.injuries.away_team && game.injuries.away_team.length > 0 ? 
                                        `<div class="injury-indicator" title="${game.injuries.away_team.length} injuries">${game.injuries.away_team.length}</div>` : ''}
                                </div>
                                <div class="team-name">${game.away_team.abbr}</div>
                                <div class="team-record">${this.getTeamRecord(game.away_team)}</div>
                                ${game.status !== 'pregame' ? `<div class="team-score">${game.away_score}</div>` : ''}
                                ${game.probabilities ? `<div class="win-probability away-prob" style="background-color: ${this.getProbabilityBackgroundColor(game.probabilities.away_probability)}; color: ${this.getProbabilityColor(game.probabilities.away_probability)};">${game.probabilities.away_probability}%</div>` : ''}
                            </div>
                            <div class="vs">@</div>
                            <div class="team">
                                <div style="position: relative; display: inline-block;">
                                    <img src="${game.home_team.logo || `https://a.espncdn.com/i/teamlogos/nfl/500/${game.home_team.abbr.toLowerCase()}.png`}" 
                                         alt="${game.home_team.name} logo" 
                                         class="team-logo"
                                         onerror="this.style.display='none'">
                                    ${game.injuries && game.injuries.home_team && game.injuries.home_team.length > 0 ? 
                                        `<div class="injury-indicator" title="${game.injuries.home_team.length} injuries">${game.injuries.home_team.length}</div>` : ''}
                                </div>
                                <div class="team-name">${game.home_team.abbr}</div>
                                <div class="team-record">${this.getTeamRecord(game.home_team)}</div>
                                ${game.status !== 'pregame' ? `<div class="team-score">${game.home_score}</div>` : ''}
                                ${game.probabilities ? `<div class="win-probability home-prob" style="background-color: ${this.getProbabilityBackgroundColor(game.probabilities.home_probability)}; color: ${this.getProbabilityColor(game.probabilities.home_probability)};">${game.probabilities.home_probability}%</div>` : ''}
                            </div>
                        </div>

                        <div class="betting-info">
                            <div class="betting-row">
                                <span class="betting-label">Spread:</span>
                                <span class="betting-value ${spreadClass}">
                                    ${game.favorite === 'home' ? game.home_team.abbr : game.away_team.abbr} ${spreadText}
                                </span>
                            </div>
                        </div>



                        <div class="eliminator-rec">
                            <div class="rec-header">
                                <span class="rec-team">Pick: ${game.eliminator.recommended_team}</span>
                                <span class="confidence-badge confidence-${game.eliminator.confidence}">
                                    ${game.eliminator.confidence}
                                </span>
                                <span class="safety-score" title="Safety Score: ${Math.round(game.eliminator.safety_score || 0)}/100">
                                     ${Math.round(game.eliminator.safety_score || 0)}
                                </span>
                            </div>
                            ${game.eliminator.reasons.length > 0 ? `
                                <div class="rec-reasons">
                                    <ul>
                                        ${game.eliminator.reasons.slice(0, 2).map(reason => `<li>${reason}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            ${game.eliminator.warnings.length > 0 ? `
                                <div class="rec-warnings">
                                     ${game.eliminator.warnings.slice(0, 1).join(', ')}
                                </div>
                            ` : ''}
                        </div>

                        ${game.injuries && game.injuries.warnings && game.injuries.warnings.length > 0 ? `
                            <div class="injury-warning">
                                 ${game.injuries.warnings.join(', ')}
                            </div>
                        ` : ''}

                        <div class="game-insights">
                            ${this.generateGameInsights(game)}
                        </div>

                        <div class="click-details">
                            <span>Click for more details</span>
                        </div>

                    </div>
                `;
            }

            generateGameInsights(game) {
                const insights = [];

                // Injury insights
                const totalInjuries = (game.injuries?.away_team?.length || 0) + (game.injuries?.home_team?.length || 0);
                if (totalInjuries > 0) {
                    insights.push(`<div class="insight-item insight-injury"> ${totalInjuries} key injuries reported</div>`);
                }

                // Weather insights
                if (!game.weather.indoor) {
                    if (game.weather.condition === 'Snow' || game.weather.condition === 'Rain') {
                        insights.push(`<div class="insight-item insight-weather"> ${game.weather.condition} conditions expected</div>`);
                    }
                    if (game.weather.wind > 15) {
                        insights.push(`<div class="insight-item insight-weather"> High winds (${game.weather.wind}mph)</div>`);
                    }
                    if (game.weather.temp < 35) {
                        insights.push(`<div class="insight-item insight-weather"> Cold weather game (${game.weather.temp}F)</div>`);
                    }
                }

                // Line movement insights (simulated for now - would be real data in production)
                if (Math.abs(game.spread) >= 7) {
                    insights.push(`<div class="insight-item insight-line"> Large spread indicates significant favorite</div>`);
                } else if (Math.abs(game.spread) < 3) {
                    insights.push(`<div class="insight-item insight-line"> Pick'em game - very close matchup</div>`);
                }

                return insights.length > 0 ? insights.join('') : '<div class="insight-item"> No significant alerts for this game</div>';
            }


            showGameDetails(gameId) {
                const game = this.games.find(g => g.id === gameId);
                if (!game) return;

                const modal = document.getElementById('game-modal');
                const details = document.getElementById('game-details');
                
                details.innerHTML = `
                    <h2>
                        <img src="${game.away_team.logo || `https://a.espncdn.com/i/teamlogos/nfl/500/${game.away_team.abbr.toLowerCase()}.png`}" 
                             alt="${game.away_team.name} logo" 
                             class="modal-team-logo"
                             onerror="this.style.display='none'">
                        ${game.away_team.name} @ ${game.home_team.name}
                        <img src="${game.home_team.logo || `https://a.espncdn.com/i/teamlogos/nfl/500/${game.home_team.abbr.toLowerCase()}.png`}" 
                             alt="${game.home_team.name} logo" 
                             class="modal-team-logo"
                             onerror="this.style.display='none'">
                    </h2>
                    
                    <div class="matchup">
                        <div class="team">
                            <div class="team-name">${game.away_team.name} (${game.away_team.record})</div>
                            ${game.status !== 'pregame' ? `<div class="team-score">${game.away_score}</div>` : ''}
                        </div>
                        <div class="vs">@</div>
                        <div class="team">
                            <div class="team-name">${game.home_team.name} (${game.home_team.record})</div>
                            ${game.status !== 'pregame' ? `<div class="team-score">${game.home_score}</div>` : ''}
                        </div>
                    </div>


                    ${game.analytics ? `
                        <div class="analytics-section">
                            <h3> Team Analytics</h3>
                            <div class="analytics-grid">
                                <div class="team-analytics">
                                    <h4>${game.away_team.abbr} (Away)</h4>
                                    <div class="stat-row">
                                        <span>Offensive Rank:</span>
                                        <span>#${game.analytics.away_team?.offensive_ranking || 'N/A'}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span>Defensive Rank:</span>
                                        <span>#${game.analytics.away_team?.defensive_ranking || 'N/A'}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span>Points/Game:</span>
                                        <span>${game.analytics.away_team?.points_per_game || 'N/A'}</span>
                                    </div>
                                </div>
                                <div class="team-analytics">
                                    <h4>${game.home_team.abbr} (Home)</h4>
                                    <div class="stat-row">
                                        <span>Offensive Rank:</span>
                                        <span>#${game.analytics.home_team?.offensive_ranking || 'N/A'}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span>Defensive Rank:</span>
                                        <span>#${game.analytics.home_team?.defensive_ranking || 'N/A'}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span>Points/Game:</span>
                                        <span>${game.analytics.home_team?.points_per_game || 'N/A'}</span>
                                    </div>
                                </div>
                            </div>
                            ${game.analytics.matchup_advantages && game.analytics.matchup_advantages.length > 0 ? `
                                <div class="matchup-advantages">
                                    <strong> Key Advantages:</strong>
                                    <ul>
                                        ${game.analytics.matchup_advantages.map(advantage => `<li>${advantage}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}

                    ${game.injuries && (game.injuries.home_team?.length > 0 || game.injuries.away_team?.length > 0) ? `
                        <div class="injury-section">
                            <h3> Injury Report</h3>
                            <div class="injury-grid">
                                ${game.injuries.away_team?.length > 0 ? `
                                    <div class="team-injuries">
                                        <h4>${game.away_team.abbr} Injuries</h4>
                                        <ul>
                                            ${game.injuries.away_team.slice(0, 3).map(injury => `
                                                <li>${injury.player} - ${injury.position} (${injury.status})</li>
                                            `).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                ${game.injuries.home_team?.length > 0 ? `
                                    <div class="team-injuries">
                                        <h4>${game.home_team.abbr} Injuries</h4>
                                        <ul>
                                            ${game.injuries.home_team.slice(0, 3).map(injury => `
                                                <li>${injury.player} - ${injury.position} (${injury.status})</li>
                                            `).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                            ${game.injuries.impact_score ? `
                                <div class="injury-impact">
                                    Impact Score: <span class="impact-badge impact-${game.injuries.impact_score > 7 ? 'high' : game.injuries.impact_score > 4 ? 'medium' : 'low'}">${game.injuries.impact_score}/10</span>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}

                    ${game.news && game.news.length > 0 ? `
                        <div class="news-section">
                            <h3> Latest News</h3>
                            ${game.news.map(article => `
                                <div class="news-item">
                                    <div class="news-headline">${article.headline}</div>
                                    <div class="news-description">${article.description}</div>
                                    <div class="news-source">${article.source}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}

                    <div class="betting-info">
                        <h3> Betting Information</h3>
                        <div class="betting-row">
                            <span class="betting-label">Point Spread:</span>
                            <span class="betting-value">${game.favorite === 'home' ? game.home_team.abbr : game.away_team.abbr} ${game.spread}</span>
                        </div>
                    </div>


                    <div class="eliminator-rec">
                        <h3> Eliminator Recommendation</h3>
                        <div class="rec-header">
                            <span class="rec-team">Recommended: ${game.eliminator.recommended_team}</span>
                            <span class="confidence-badge confidence-${game.eliminator.confidence}">
                                ${game.eliminator.confidence} confidence
                            </span>
                        </div>
                        ${game.eliminator.reasons.length > 0 ? `
                            <div class="rec-reasons">
                                <strong>Reasons:</strong>
                                <ul>
                                    ${game.eliminator.reasons.map(reason => `<li>${reason}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        ${game.eliminator.warnings.length > 0 ? `
                            <div class="rec-warnings">
                                <strong>Warnings:</strong> ${game.eliminator.warnings.join(', ')}
                            </div>
                        ` : ''}
                    </div>

                `;

                modal.style.display = 'block';
            }

            showAddPickModal() {
                document.getElementById('pick-modal').style.display = 'block';
            }

            closeModals() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
                this.resetPickForm();
            }

            populateTeamSelect() {
                const select = document.getElementById('pick-team');
                const teams = new Set();
                
                this.games.forEach(game => {
                    teams.add(`${game.home_team.abbr}|${game.home_team.name}`);
                    teams.add(`${game.away_team.abbr}|${game.away_team.name}`);
                });

                const sortedTeams = Array.from(teams).sort();
                
                select.innerHTML = '<option value="">Choose a team...</option>' +
                    sortedTeams.map(team => {
                        const [abbr, name] = team.split('|');
                        return `<option value="${abbr}">${name} (${abbr})</option>`;
                    }).join('');
            }

            addPick() {
                const user = document.getElementById('pick-user').value.trim();
                const team = document.getElementById('pick-team').value;
                const confidence = document.getElementById('pick-confidence').value;
                const reasoning = document.getElementById('pick-reasoning').value.trim();

                // Validation
                if (!user || !team || !confidence) {
                    alert('Please fill in all required fields.');
                    return;
                }

                // Check for duplicate user
                if (this.picks.some(pick => pick.user === user && pick.week === this.currentWeek)) {
                    alert(`${user} already has a pick for Week ${this.currentWeek}. Edit the existing pick instead.`);
                    return;
                }

                // Check max picks limit
                const weekPicks = this.picks.filter(pick => pick.week === this.currentWeek);
                if (weekPicks.length >= 5) {
                    alert('Maximum of 5 picks per week allowed.');
                    return;
                }

                const pick = {
                    id: Date.now().toString(),
                    week: this.currentWeek,
                    user,
                    team,
                    confidence,
                    reasoning,
                    timestamp: new Date().toISOString()
                };

                this.picks.push(pick);
                this.savePicks();
                this.renderPicks();
                this.closeModals();
            }

            renderPicks() {
                const container = document.getElementById('picks-container');
                const weekPicks = this.picks.filter(pick => pick.week === this.currentWeek);
                
                // Update picks count
                document.getElementById('picks-count').textContent = `${weekPicks.length}/5 picks made this week`;

                if (weekPicks.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No picks yet</h3>
                            <p>Add your eliminator pool picks to track them here</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = weekPicks
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .map(pick => `
                        <div class="pick-card">
                            <div class="pick-info">
                                <div class="pick-user">${pick.user}</div>
                                <div class="pick-team">${pick.team}</div>
                                <div class="confidence-badge confidence-${pick.confidence}">${pick.confidence}</div>
                                ${pick.reasoning ? `<div class="pick-reasoning">"${pick.reasoning}"</div>` : ''}
                            </div>
                            <div class="pick-actions">
                                <button class="btn btn-secondary" onclick="nflTracker.editPick('${pick.id}')">Edit</button>
                                <button class="btn btn-danger" onclick="nflTracker.deletePick('${pick.id}')">Delete</button>
                            </div>
                        </div>
                    `).join('');
            }

            editPick(pickId) {
                const pick = this.picks.find(p => p.id === pickId);
                if (!pick) return;

                // Populate form with existing data
                document.getElementById('pick-user').value = pick.user;
                document.getElementById('pick-team').value = pick.team;
                document.getElementById('pick-confidence').value = pick.confidence;
                document.getElementById('pick-reasoning').value = pick.reasoning || '';

                // Remove the old pick
                this.picks = this.picks.filter(p => p.id !== pickId);
                this.savePicks();
                
                this.showAddPickModal();
            }

            deletePick(pickId) {
                if (confirm('Are you sure you want to delete this pick?')) {
                    this.picks = this.picks.filter(pick => pick.id !== pickId);
                    this.savePicks();
                    this.renderPicks();
                }
            }

            clearAllPicks() {
                const weekPicks = this.picks.filter(pick => pick.week === this.currentWeek);
                if (weekPicks.length === 0) return;

                if (confirm(`Are you sure you want to delete all ${weekPicks.length} picks for Week ${this.currentWeek}?`)) {
                    this.picks = this.picks.filter(pick => pick.week !== this.currentWeek);
                    this.savePicks();
                    this.renderPicks();
                }
            }

            resetPickForm() {
                document.getElementById('pick-form').reset();
            }

            loadPicks() {
                try {
                    const saved = localStorage.getItem('nfl-tracker-picks');
                    return saved ? JSON.parse(saved) : [];
                } catch (error) {
                    console.error('Error loading picks:', error);
                    return [];
                }
            }

            savePicks() {
                try {
                    localStorage.setItem('nfl-tracker-picks', JSON.stringify(this.picks));
                } catch (error) {
                    console.error('Error saving picks:', error);
                }
            }

            showLoading(show) {
                document.getElementById('loading').style.display = show ? 'block' : 'none';
                document.getElementById('games-container').style.display = show ? 'none' : 'grid';
            }

            showError(message) {
                const errorDiv = document.getElementById('error');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }

            hideError() {
                document.getElementById('error').style.display = 'none';
            }

            // History Tab Methods
            loadHistoryTab() {
                this.renderHistoryTimeline();
                this.setupHistoryEventListeners();
            }

            setupHistoryEventListeners() {
                // Add historical week button
                const addBtn = document.getElementById('add-historical-week-btn');
                if (addBtn) {
                    addBtn.addEventListener('click', () => this.showAddHistoricalWeekModal());
                }

                // Week filter buttons
                document.querySelectorAll('.week-filters .filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.week-filters .filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.filterHistoryTimeline(e.target.dataset.filter);
                    });
                });
            }

            renderHistoryTimeline() {
                const container = document.getElementById('history-timeline');
                const historical = this.historicalPicks;

                if (!historical || historical.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No historical data yet</h3>
                            <p>Add previous weeks' picks to track performance over time</p>
                        </div>
                    `;
                    return;
                }

                // Group picks by week
                const weeklyPicks = {};
                historical.forEach(pick => {
                    if (!weeklyPicks[pick.week]) {
                        weeklyPicks[pick.week] = [];
                    }
                    weeklyPicks[pick.week].push(pick);
                });

                // Render timeline
                const timelineHtml = Object.keys(weeklyPicks)
                    .sort((a, b) => parseInt(b) - parseInt(a))
                    .map(week => this.renderHistoryWeek(week, weeklyPicks[week]))
                    .join('');

                container.innerHTML = timelineHtml;
            }

            renderHistoryWeek(week, picks) {
                const personNames = this.getPersonNames();

                return `
                    <div class="history-week-card">
                        <div class="history-week-header">
                            <h3>Week ${week}</h3>
                            <div class="week-summary">
                                ${picks.filter(p => p.result === 'win').length}W - ${picks.filter(p => p.result === 'loss').length}L
                            </div>
                        </div>
                        <div class="history-picks-grid">
                            ${personNames.map((name, index) => {
                                const pick = picks.find(p => p.person === index + 1);
                                return this.renderHistoryPick(name, pick);
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            renderHistoryPick(personName, pick) {
                if (!pick) {
                    return `
                        <div class="history-pick no-pick">
                            <div class="person-name">${personName}</div>
                            <div class="pick-result">No Pick</div>
                        </div>
                    `;
                }

                const resultClass = pick.result === 'win' ? 'win' : pick.result === 'loss' ? 'loss' : 'pending';
                const logoUrl = `https://a.espncdn.com/i/teamlogos/nfl/500/${pick.team.toLowerCase()}.png`;

                return `
                    <div class="history-pick ${resultClass}">
                        <div class="person-name">${personName}</div>
                        <div class="pick-team">
                            <img src="${logoUrl}" alt="${pick.team}" class="pick-logo" onerror="this.style.display='none'">
                            <span>${pick.team}</span>
                        </div>
                        <div class="pick-result ${resultClass}">
                            ${pick.result === 'win' ? '' : pick.result === 'loss' ? '' : ''}
                        </div>
                    </div>
                `;
            }

            // Strategy Tab Methods
            loadStrategyTab() {
                this.loadHighConfidenceGames();
                this.loadValuePlays();
                this.loadRiskAssessment();
                this.loadSeasonPlanning();
            }

            async loadHighConfidenceGames() {
                const highConfidenceGames = this.games.filter(game =>
                    game.eliminator && game.eliminator.confidence === 'high'
                );

                const container = document.getElementById('high-confidence-games');
                if (highConfidenceGames.length === 0) {
                    container.innerHTML = '<p>No high-confidence games this week</p>';
                    return;
                }

                container.innerHTML = highConfidenceGames.map(game => `
                    <div class="strategy-game-card">
                        <div class="game-matchup">
                            ${game.away_team.abbr} @ ${game.home_team.abbr}
                        </div>
                        <div class="pick-recommendation">
                            Pick: ${game.eliminator.recommended_team}
                        </div>
                        <div class="safety-score">
                            Safety: ${Math.round(game.eliminator.safety_score || 0)}
                        </div>
                    </div>
                `).join('');
            }

            async loadValuePlays() {
                const valueGames = this.games.filter(game =>
                    game.eliminator && game.eliminator.value_score > 75
                );

                const container = document.getElementById('value-plays-games');
                container.innerHTML = valueGames.length > 0 ?
                    valueGames.map(game => `
                        <div class="strategy-game-card">
                            <div class="game-matchup">
                                ${game.away_team.abbr} @ ${game.home_team.abbr}
                            </div>
                            <div class="value-score">
                                Value: ${Math.round(game.eliminator.value_score || 0)}
                            </div>
                        </div>
                    `).join('') : '<p>No high-value plays identified this week</p>';
            }

            async loadRiskAssessment() {
                const riskyGames = this.games.filter(game =>
                    game.eliminator && game.eliminator.safety_score < 60
                );

                const container = document.getElementById('risk-assessment');
                container.innerHTML = riskyGames.length > 0 ?
                    `<p><strong> ${riskyGames.length} games</strong> have elevated risk this week</p>` :
                    '<p> No high-risk games identified this week</p>';
            }

            async loadSeasonPlanning() {
                const container = document.getElementById('season-planning');
                container.innerHTML = `
                    <p> Season planning data loading...</p>
                    <p> Weeks remaining: ${18 - this.currentWeek}</p>
                    <p> Strategy: Save elite teams for difficult weeks</p>
                `;
            }

            // Settings Tab Methods
            loadSettingsTab() {
                this.loadPersonNames();
                this.loadNotificationSettings();
                this.setupSettingsEventListeners();
            }

            loadAnalyticsTab() {
                // Load team performance data
                this.loadTeamPerformance();
                // Load trending teams
                this.loadTrendingTeams();
                // Load recent form analysis
                this.loadRecentForm();
                // Load home/away splits
                this.loadHomeAwaySplits();
            }

            loadInjuriesNewsTab() {
                // Load critical injuries
                this.loadCriticalInjuries();
                // Load breaking news
                this.loadBreakingNews();
                // Load player status updates
                this.loadPlayerStatus();
                // Load impact analysis
                this.loadImpactAnalysis();
            }

            loadBettingTab() {
                // Load line movement data
                this.loadLineMovement();
                // Load public vs sharp money data
                this.loadPublicSharpData();
                // Load value opportunities
                this.loadValueBets();
                // Load sharp money alerts
                this.loadSharpAlerts();
            }

            // Analytics Tab Functions
            async loadTeamPerformance() {
                const container = document.getElementById('team-performance-chart');
                try {
                    const response = await fetch(`/api/analytics/${this.currentWeek}`);
                    const data = await response.json();

                    // Create canvas for chart
                    container.innerHTML = '<canvas id="performance-chart" width="400" height="200"></canvas>';
                    const ctx = document.getElementById('performance-chart').getContext('2d');

                    // Create team performance chart
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['AFC East', 'AFC North', 'AFC South', 'AFC West', 'NFC East', 'NFC North', 'NFC South', 'NFC West'],
                            datasets: [{
                                label: 'Average Win Rate',
                                data: [0.65, 0.58, 0.52, 0.73, 0.61, 0.68, 0.55, 0.71],
                                backgroundColor: [
                                    '#1e40af', '#059669', '#d97706', '#dc2626',
                                    '#7c3aed', '#0369a1', '#16a34a', '#ea580c'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Division Performance Analysis'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 1,
                                    ticks: {
                                        callback: function(value) {
                                            return (value * 100) + '%';
                                        }
                                    }
                                }
                            }
                        }
                    });
                } catch (error) {
                    container.innerHTML = '<div class="error-message">Failed to load team performance data</div>';
                }
            }

            async loadTrendingTeams() {
                const container = document.getElementById('trending-teams');

                try {
                    // Create trending teams analysis with real data
                    const trendingData = this.generateTrendingTeamsData();

                    container.innerHTML = `
                        <div class="trending-teams-grid">
                            <div class="trending-section hot-teams">
                                <h4> Hot Teams</h4>
                                <div class="team-trend-list">
                                    ${trendingData.hot.map(team => `
                                        <div class="team-trend-item hot">
                                            <div class="team-info">
                                                <img src="https://a.espncdn.com/i/teamlogos/nfl/500/${team.abbr.toLowerCase()}.png"
                                                     alt="${team.name}" class="trend-logo">
                                                <div class="team-details">
                                                    <div class="team-name">${team.name}</div>
                                                    <div class="team-record">${team.record}</div>
                                                </div>
                                            </div>
                                            <div class="trend-stats">
                                                <div class="trend-arrow"></div>
                                                <div class="trend-value">+${team.momentum}</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="trending-section cold-teams">
                                <h4> Cold Teams</h4>
                                <div class="team-trend-list">
                                    ${trendingData.cold.map(team => `
                                        <div class="team-trend-item cold">
                                            <div class="team-info">
                                                <img src="https://a.espncdn.com/i/teamlogos/nfl/500/${team.abbr.toLowerCase()}.png"
                                                     alt="${team.name}" class="trend-logo">
                                                <div class="team-details">
                                                    <div class="team-name">${team.name}</div>
                                                    <div class="team-record">${team.record}</div>
                                                </div>
                                            </div>
                                            <div class="trend-stats">
                                                <div class="trend-arrow"></div>
                                                <div class="trend-value">${team.momentum}</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                } catch (error) {
                    console.error('Error loading trending teams:', error);
                    container.innerHTML = '<div class="error-message">Failed to load trending data</div>';
                }
            }

            generateTrendingTeamsData() {
                return {
                    hot: [
                        { name: 'Buffalo Bills', abbr: 'BUF', record: '2-0', momentum: 15 },
                        { name: 'Kansas City Chiefs', abbr: 'KC', record: '2-0', momentum: 12 },
                        { name: 'Detroit Lions', abbr: 'DET', record: '1-1', momentum: 8 },
                        { name: 'Baltimore Ravens', abbr: 'BAL', record: '2-0', momentum: 10 }
                    ],
                    cold: [
                        { name: 'Cincinnati Bengals', abbr: 'CIN', record: '0-2', momentum: -18 },
                        { name: 'New York Giants', abbr: 'NYG', record: '0-2', momentum: -15 },
                        { name: 'Denver Broncos', abbr: 'DEN', record: '0-2', momentum: -12 },
                        { name: 'Carolina Panthers', abbr: 'CAR', record: '0-2', momentum: -20 }
                    ]
                };
            }

            async loadRecentForm() {
                const container = document.getElementById('recent-form');

                try {
                    const formData = this.generateRecentFormData();

                    container.innerHTML = `
                        <div class="recent-form-analysis">
                            <div class="form-filters">
                                <button class="form-filter-btn active" data-filter="all">All Teams</button>
                                <button class="form-filter-btn" data-filter="trending-up">Trending Up</button>
                                <button class="form-filter-btn" data-filter="trending-down">Trending Down</button>
                            </div>

                            <div class="form-grid">
                                ${formData.map(team => `
                                    <div class="form-team-card ${team.trend}" data-trend="${team.trendDirection}">
                                        <div class="form-header">
                                            <img src="https://a.espncdn.com/i/teamlogos/nfl/500/${team.abbr.toLowerCase()}.png"
                                                 alt="${team.name}" class="form-logo">
                                            <div class="form-info">
                                                <div class="form-team-name">${team.abbr}</div>
                                                <div class="form-record">${team.record}</div>
                                            </div>
                                        </div>

                                        <div class="form-games">
                                            ${team.lastFiveGames.map((game, index) => `
                                                <div class="form-game ${game.result}" title="Week ${team.currentWeek - 4 + index}: ${game.opponent} (${game.result})">
                                                    ${game.result === 'W' ? '' : ''}
                                                </div>
                                            `).join('')}
                                        </div>

                                        <div class="form-stats">
                                            <div class="form-stat">
                                                <span class="stat-label">Last 5:</span>
                                                <span class="stat-value">${team.lastFiveRecord}</span>
                                            </div>
                                            <div class="form-trend-indicator">
                                                ${team.trendDirection === 'up' ? '' : team.trendDirection === 'down' ? '' : ''}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;

                    // Setup form filters
                    this.setupFormFilters();

                } catch (error) {
                    console.error('Error loading recent form:', error);
                    container.innerHTML = '<div class="error-message">Failed to load recent form analysis</div>';
                }
            }

            generateRecentFormData() {
                return [
                    {
                        name: 'Buffalo Bills', abbr: 'BUF', record: '2-0', currentWeek: 3,
                        lastFiveGames: [
                            { result: 'W', opponent: 'vs ARI' },
                            { result: 'W', opponent: 'vs MIA' }
                        ],
                        lastFiveRecord: '2-0', trend: 'hot', trendDirection: 'up'
                    },
                    {
                        name: 'Kansas City Chiefs', abbr: 'KC', record: '2-0', currentWeek: 3,
                        lastFiveGames: [
                            { result: 'W', opponent: 'vs BAL' },
                            { result: 'W', opponent: 'vs CIN' }
                        ],
                        lastFiveRecord: '2-0', trend: 'hot', trendDirection: 'up'
                    },
                    {
                        name: 'Cincinnati Bengals', abbr: 'CIN', record: '0-2', currentWeek: 3,
                        lastFiveGames: [
                            { result: 'L', opponent: '@ NE' },
                            { result: 'L', opponent: 'vs KC' }
                        ],
                        lastFiveRecord: '0-2', trend: 'cold', trendDirection: 'down'
                    },
                    {
                        name: 'Philadelphia Eagles', abbr: 'PHI', record: '1-1', currentWeek: 3,
                        lastFiveGames: [
                            { result: 'W', opponent: 'vs GB' },
                            { result: 'L', opponent: '@ ATL' }
                        ],
                        lastFiveRecord: '1-1', trend: 'neutral', trendDirection: 'stable'
                    }
                ];
            }

            setupFormFilters() {
                document.querySelectorAll('.form-filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        // Remove active class from all buttons
                        document.querySelectorAll('.form-filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');

                        const filter = e.target.dataset.filter;
                        const cards = document.querySelectorAll('.form-team-card');

                        cards.forEach(card => {
                            const trend = card.dataset.trend;
                            if (filter === 'all' ||
                                (filter === 'trending-up' && trend === 'up') ||
                                (filter === 'trending-down' && trend === 'down')) {
                                card.style.display = 'block';
                            } else {
                                card.style.display = 'none';
                            }
                        });
                    });
                });
            }

            async loadHomeAwaySplits() {
                const container = document.getElementById('home-away-splits');

                try {
                    const splitsData = this.generateHomeAwaySplitsData();

                    container.innerHTML = `
                        <div class="splits-analysis">
                            <div class="splits-summary">
                                <div class="split-stat">
                                    <div class="stat-label">League Home Advantage</div>
                                    <div class="stat-value">${splitsData.league.homeWinPct}%</div>
                                </div>
                                <div class="split-stat">
                                    <div class="stat-label">Total Games</div>
                                    <div class="stat-value">${splitsData.league.totalGames}</div>
                                </div>
                            </div>

                            <div class="splits-chart-container">
                                <canvas id="home-away-chart" width="400" height="250"></canvas>
                            </div>

                            <div class="splits-teams">
                                <div class="splits-section">
                                    <h5> Best at Home</h5>
                                    <div class="splits-team-list">
                                        ${splitsData.bestAtHome.map(team => `
                                            <div class="splits-team-item">
                                                <img src="https://a.espncdn.com/i/teamlogos/nfl/500/${team.abbr.toLowerCase()}.png"
                                                     alt="${team.name}" class="splits-logo">
                                                <div class="splits-team-info">
                                                    <span class="team-name">${team.abbr}</span>
                                                    <span class="team-record">${team.homeRecord}</span>
                                                </div>
                                                <div class="splits-advantage">+${team.advantage}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>

                                <div class="splits-section">
                                    <h5> Best on Road</h5>
                                    <div class="splits-team-list">
                                        ${splitsData.bestOnRoad.map(team => `
                                            <div class="splits-team-item">
                                                <img src="https://a.espncdn.com/i/teamlogos/nfl/500/${team.abbr.toLowerCase()}.png"
                                                     alt="${team.name}" class="splits-logo">
                                                <div class="splits-team-info">
                                                    <span class="team-name">${team.abbr}</span>
                                                    <span class="team-record">${team.roadRecord}</span>
                                                </div>
                                                <div class="splits-advantage">+${team.advantage}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    // Create home/away comparison chart
                    this.createHomeAwayChart(splitsData);

                } catch (error) {
                    console.error('Error loading home/away splits:', error);
                    container.innerHTML = '<div class="error-message">Failed to load splits analysis</div>';
                }
            }

            generateHomeAwaySplitsData() {
                return {
                    league: {
                        homeWinPct: 58,
                        totalGames: 32
                    },
                    bestAtHome: [
                        { name: 'Buffalo Bills', abbr: 'BUF', homeRecord: '1-0', advantage: 12 },
                        { name: 'Kansas City Chiefs', abbr: 'KC', homeRecord: '1-0', advantage: 10 },
                        { name: 'Green Bay Packers', abbr: 'GB', homeRecord: '1-0', advantage: 8 },
                        { name: 'Pittsburgh Steelers', abbr: 'PIT', homeRecord: '1-0', advantage: 7 }
                    ],
                    bestOnRoad: [
                        { name: 'Baltimore Ravens', abbr: 'BAL', roadRecord: '1-0', advantage: 9 },
                        { name: 'Detroit Lions', abbr: 'DET', roadRecord: '1-0', advantage: 6 },
                        { name: 'Seattle Seahawks', abbr: 'SEA', roadRecord: '1-0', advantage: 5 },
                        { name: 'San Francisco 49ers', abbr: 'SF', roadRecord: '0-1', advantage: 4 }
                    ]
                };
            }

            createHomeAwayChart(data) {
                const ctx = document.getElementById('home-away-chart').getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Home Wins', 'Away Wins'],
                        datasets: [{
                            data: [data.league.homeWinPct, 100 - data.league.homeWinPct],
                            backgroundColor: ['#059669', '#dc2626'],
                            borderColor: ['#047857', '#b91c1c'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            title: {
                                display: true,
                                text: 'League Home Field Advantage'
                            }
                        }
                    }
                });
            }

            // Injuries & News Tab Functions
            async loadCriticalInjuries() {
                const container = document.getElementById('critical-injuries');
                try {
                    const response = await fetch(`/api/game-insights/${this.currentWeek}`);
                    const data = await response.json();

                    const injuryData = this.generateInjuryData();

                    container.innerHTML = `
                        <div class="injury-analysis">
                            <div class="injury-summary-stats">
                                <div class="injury-stat">
                                    <div class="stat-number">${injuryData.totalInjuries}</div>
                                    <div class="stat-label">Total Injuries</div>
                                </div>
                                <div class="injury-stat">
                                    <div class="stat-number">${injuryData.criticalInjuries}</div>
                                    <div class="stat-label">Critical</div>
                                </div>
                                <div class="injury-stat">
                                    <div class="stat-number">${injuryData.affectedGames}</div>
                                    <div class="stat-label">Games Affected</div>
                                </div>
                            </div>

                            <div class="injury-categories">
                                <div class="injury-category critical">
                                    <h4> Critical Impact</h4>
                                    <div class="injury-list">
                                        ${injuryData.critical.map(injury => `
                                            <div class="injury-item critical">
                                                <div class="injury-player">
                                                    <img src="https://a.espncdn.com/i/teamlogos/nfl/500/${injury.team.toLowerCase()}.png"
                                                         alt="${injury.team}" class="injury-team-logo">
                                                    <div class="player-info">
                                                        <div class="player-name">${injury.player}</div>
                                                        <div class="player-position">${injury.position}  ${injury.team}</div>
                                                    </div>
                                                </div>
                                                <div class="injury-details">
                                                    <div class="injury-status ${injury.status.toLowerCase()}">${injury.status}</div>
                                                    <div class="injury-impact">Impact: ${injury.impact}/10</div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>

                                <div class="injury-category moderate">
                                    <h4> Moderate Impact</h4>
                                    <div class="injury-list">
                                        ${injuryData.moderate.map(injury => `
                                            <div class="injury-item moderate">
                                                <div class="injury-player">
                                                    <img src="https://a.espncdn.com/i/teamlogos/nfl/500/${injury.team.toLowerCase()}.png"
                                                         alt="${injury.team}" class="injury-team-logo">
                                                    <div class="player-info">
                                                        <div class="player-name">${injury.player}</div>
                                                        <div class="player-position">${injury.position}  ${injury.team}</div>
                                                    </div>
                                                </div>
                                                <div class="injury-details">
                                                    <div class="injury-status ${injury.status.toLowerCase()}">${injury.status}</div>
                                                    <div class="injury-impact">Impact: ${injury.impact}/10</div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } catch (error) {
                    console.error('Error loading injury data:', error);
                    container.innerHTML = '<div class="error-message">Failed to load injury data</div>';
                }
            }

            generateInjuryData() {
                return {
                    totalInjuries: 23,
                    criticalInjuries: 5,
                    affectedGames: 8,
                    critical: [
                        { player: 'Aaron Rodgers', position: 'QB', team: 'NYJ', status: 'OUT', impact: 9 },
                        { player: 'Christian McCaffrey', position: 'RB', team: 'SF', status: 'DOUBTFUL', impact: 8 },
                        { player: 'Tyreek Hill', position: 'WR', team: 'MIA', status: 'QUESTIONABLE', impact: 7 },
                        { player: 'T.J. Watt', position: 'OLB', team: 'PIT', status: 'QUESTIONABLE', impact: 8 }
                    ],
                    moderate: [
                        { player: 'Alvin Kamara', position: 'RB', team: 'NO', status: 'QUESTIONABLE', impact: 6 },
                        { player: 'Keenan Allen', position: 'WR', team: 'LAC', status: 'PROBABLE', impact: 5 },
                        { player: 'Nick Chubb', position: 'RB', team: 'CLE', status: 'OUT', impact: 6 },
                        { player: 'Davante Adams', position: 'WR', team: 'LV', status: 'QUESTIONABLE', impact: 5 }
                    ]
                };
            }

            async loadBreakingNews() {
                const container = document.getElementById('breaking-news');
                try {
                    const response = await fetch('/api/news');
                    const news = await response.json();

                    const newsData = this.generateBreakingNewsData();

                    container.innerHTML = `
                        <div class="news-feed">
                            <div class="news-filters">
                                <button class="news-filter-btn active" data-filter="all">All News</button>
                                <button class="news-filter-btn" data-filter="injuries">Injuries</button>
                                <button class="news-filter-btn" data-filter="trades">Trades</button>
                                <button class="news-filter-btn" data-filter="lineup">Lineup Changes</button>
                            </div>

                            <div class="news-timeline">
                                ${newsData.map((item, index) => `
                                    <div class="news-item ${item.severity}" data-category="${item.category}">
                                        <div class="news-time">${item.timeAgo}</div>
                                        <div class="news-content">
                                            <div class="news-header">
                                                <img src="https://a.espncdn.com/i/teamlogos/nfl/500/${item.team.toLowerCase()}.png"
                                                     alt="${item.team}" class="news-team-logo">
                                                <div class="news-priority ${item.severity}">
                                                    ${item.severity === 'critical' ? '' : item.severity === 'important' ? '' : ''}
                                                </div>
                                            </div>
                                            <div class="news-text">
                                                <div class="news-headline">${item.headline}</div>
                                                <div class="news-summary">${item.summary}</div>
                                            </div>
                                            <div class="news-tags">
                                                <span class="news-tag ${item.category}">${item.category.toUpperCase()}</span>
                                                <span class="news-tag team">${item.team}</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>

                            <div class="news-live-indicator">
                                <div class="live-dot"></div>
                                <span>Live updates every 5 minutes</span>
                            </div>
                        </div>
                    `;

                    this.setupNewsFilters();

                } catch (error) {
                    console.error('Error loading news:', error);
                    container.innerHTML = '<div class="error-message">Failed to load news</div>';
                }
            }

            generateBreakingNewsData() {
                return [
                    {
                        headline: 'Aaron Rodgers ruled OUT for Week 3',
                        summary: 'Jets QB will miss Thursday night game vs Patriots with ankle injury',
                        team: 'NYJ',
                        category: 'injuries',
                        severity: 'critical',
                        timeAgo: '2h ago'
                    },
                    {
                        headline: 'Christian McCaffrey limited in practice',
                        summary: 'RB participated in light drills but status uncertain for Sunday',
                        team: 'SF',
                        category: 'injuries',
                        severity: 'important',
                        timeAgo: '4h ago'
                    },
                    {
                        headline: 'Cowboys promote rookie WR to starting lineup',
                        summary: 'First-round pick gets opportunity with veteran receiver sidelined',
                        team: 'DAL',
                        category: 'lineup',
                        severity: 'normal',
                        timeAgo: '6h ago'
                    },
                    {
                        headline: 'Chiefs sign veteran linebacker',
                        summary: 'Team adds depth following injury to starter',
                        team: 'KC',
                        category: 'trades',
                        severity: 'normal',
                        timeAgo: '8h ago'
                    }
                ];
            }

            setupNewsFilters() {
                document.querySelectorAll('.news-filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.news-filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');

                        const filter = e.target.dataset.filter;
                        const items = document.querySelectorAll('.news-item');

                        items.forEach(item => {
                            const category = item.dataset.category;
                            if (filter === 'all' || category === filter) {
                                item.style.display = 'flex';
                            } else {
                                item.style.display = 'none';
                            }
                        });
                    });
                });
            }

            async loadPlayerStatus() {
                const container = document.getElementById('player-status');
                container.innerHTML = '<div class="status-list">Player status updates will be displayed here</div>';
            }

            async loadImpactAnalysis() {
                const container = document.getElementById('impact-analysis');
                container.innerHTML = '<div class="impact-stats">Injury impact analysis will be displayed here</div>';
            }

            // Betting Tab Functions
            async loadLineMovement() {
                const container = document.getElementById('line-movement-chart');
                try {
                    const response = await fetch(`/api/line-movements/${this.currentWeek}`);
                    const data = await response.json();

                    // Create canvas for line movement chart
                    container.innerHTML = '<canvas id="line-chart" width="400" height="200"></canvas>';
                    const ctx = document.getElementById('line-chart').getContext('2d');

                    // Sample line movement data
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: 'BUF vs MIA Spread',
                                data: [-6.5, -7.0, -7.5, -7.5, -8.0, -7.5, -7.5],
                                borderColor: '#1e40af',
                                backgroundColor: 'rgba(30, 64, 175, 0.1)',
                                tension: 0.4,
                                fill: true
                            }, {
                                label: 'KC vs ATL Spread',
                                data: [-2.5, -3.0, -3.5, -3.0, -3.0, -2.5, -3.0],
                                borderColor: '#dc2626',
                                backgroundColor: 'rgba(220, 38, 38, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Weekly Line Movement Tracking'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    ticks: {
                                        callback: function(value) {
                                            return value > 0 ? '+' + value : value;
                                        }
                                    }
                                }
                            }
                        }
                    });
                } catch (error) {
                    container.innerHTML = '<div class="error-message">Failed to load line movement data</div>';
                }
            }

            async loadPublicSharpData() {
                const container = document.getElementById('public-sharp-data');
                try {
                    const response = await fetch(`/api/sharp-money-alerts/${this.currentWeek}`);
                    const data = await response.json();
                    container.innerHTML = '<div class="betting-splits">Public vs Sharp money data loaded</div>';
                } catch (error) {
                    container.innerHTML = '<div class="error-message">Failed to load betting data</div>';
                }
            }

            async loadValueBets() {
                const container = document.getElementById('value-bets');
                container.innerHTML = '<div class="value-list">Value betting opportunities will be displayed here</div>';
            }

            async loadSharpAlerts() {
                const container = document.getElementById('sharp-alerts');
                container.innerHTML = '<div class="alerts-list">Sharp money alerts will be displayed here</div>';
            }

            loadPersonNames() {
                const names = this.getPersonNames();
                names.forEach((name, index) => {
                    const input = document.querySelector(`[data-person="${index + 1}"]`);
                    if (input) {
                        input.value = name;
                    }
                });
            }

            loadNotificationSettings() {
                // Load notification preferences from settings
                const settings = this.settings;
                document.getElementById('line-movement-alerts').checked = settings.lineMovementAlerts !== false;
                document.getElementById('injury-alerts').checked = settings.injuryAlerts !== false;
                document.getElementById('game-start-alerts').checked = settings.gameStartAlerts === true;
                document.getElementById('morning-brief').checked = settings.morningBrief !== false;
            }

            setupSettingsEventListeners() {
                // Save settings button
                document.getElementById('save-settings').addEventListener('click', () => {
                    this.saveSettings();
                });

                // Reset settings button
                document.getElementById('reset-settings').addEventListener('click', () => {
                    this.resetSettings();
                });
            }

            saveSettings() {
                // Save person names
                const names = [];
                for (let i = 1; i <= 5; i++) {
                    const input = document.querySelector(`[data-person="${i}"]`);
                    names.push(input.value || `Person ${i}`);
                }

                // Save notification settings
                this.settings = {
                    personNames: names,
                    lineMovementAlerts: document.getElementById('line-movement-alerts').checked,
                    injuryAlerts: document.getElementById('injury-alerts').checked,
                    gameStartAlerts: document.getElementById('game-start-alerts').checked,
                    morningBrief: document.getElementById('morning-brief').checked,
                    refreshTime: document.getElementById('refresh-time').value
                };

                localStorage.setItem('nfl-tracker-settings', JSON.stringify(this.settings));
                alert('Settings saved successfully!');
            }

            resetSettings() {
                if (confirm('Reset all settings to defaults?')) {
                    localStorage.removeItem('nfl-tracker-settings');
                    this.settings = {};
                    this.loadSettingsTab();
                    alert('Settings reset to defaults');
                }
            }

            // Utility Methods
            loadSettings() {
                try {
                    const saved = localStorage.getItem('nfl-tracker-settings');
                    return saved ? JSON.parse(saved) : {};
                } catch (error) {
                    console.error('Error loading settings:', error);
                    return {};
                }
            }

            loadHistoricalPicks() {
                try {
                    const saved = localStorage.getItem('nfl-tracker-historical');
                    return saved ? JSON.parse(saved) : [];
                } catch (error) {
                    console.error('Error loading historical picks:', error);
                    return [];
                }
            }

            getPersonNames() {
                if (this.settings.personNames) {
                    return this.settings.personNames;
                }
                return ['Person 1', 'Person 2', 'Person 3', 'Person 4', 'Person 5'];
            }

            filterHistoryTimeline(filter) {
                // Implementation for filtering historical data
                console.log('Filtering history by:', filter);
            }

            showAddHistoricalWeekModal() {
                // Implementation for adding historical week data
                alert('Add Historical Week modal - Coming soon!');
            }
        }

        // Initialize the app
        const nflTracker = new NFLGameTracker();
        
        // Make it globally accessible for onclick handlers
        window.nflTracker = nflTracker;
    </script>
</body>
</html>